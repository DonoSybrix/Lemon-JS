var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(a){return void 0!==a};goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]));goog.exportPath_(a,c)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;
goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(a){if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(a){if(!goog.isString(a)||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};
goog.module.getInternal_=function(a){if(!COMPILED)return goog.isProvided_(a)?a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};goog.addDependency=function(a,b,c,d){if(goog.DEPENDENCIES_ENABLED){var e;a=a.replace(/\\/g,"/");for(var f=goog.dependencies_,g=0;e=b[g];g++)f.nameToPath[e]=a,f.pathIsModule[a]=!!d;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}};
goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};goog.require=function(a){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(a);if(goog.isProvided_(a))return goog.isInModuleLoader_()?goog.module.getInternal_(a):null;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.writeScripts_(b),null}a="goog.require could not find: "+a;goog.logToConsole_(a);throw Error(a);}};
goog.basePath="";goog.nullFunction=function(){};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("SCRIPT"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),d=-1==
d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importModule_=function(a){goog.importScript_("",'goog.retrieveAndExecModule_("'+a+'");')&&(goog.dependencies_.written[a]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(a,b){return goog.LOAD_MODULE_USING_EVAL&&
goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(b+"\n//# sourceURL="+a+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+b+"\n;return exports});\n//# sourceURL="+a+"\n"},goog.loadQueuedModules_=function(){var a=goog.queuedModules_.length;if(0<a){var b=goog.queuedModules_;goog.queuedModules_=[];for(var c=0;c<a;c++)goog.maybeProcessDeferredPath_(b[c])}},goog.maybeProcessDeferredDep_=function(a){goog.isDeferredModule_(a)&&goog.allDepsAreAvailable_(a)&&(a=goog.getPathFromDeps_(a),
goog.maybeProcessDeferredPath_(goog.basePath+a))},goog.isDeferredModule_=function(a){return(a=goog.getPathFromDeps_(a))&&goog.dependencies_.pathIsModule[a]?goog.basePath+a in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(a){if((a=goog.getPathFromDeps_(a))&&a in goog.dependencies_.requires)for(var b in goog.dependencies_.requires[a])if(!goog.isProvided_(b)&&!goog.isDeferredModule_(b))return!1;return!0},goog.maybeProcessDeferredPath_=function(a){if(a in goog.dependencies_.deferred){var b=
goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a];goog.globalEval(b)}},goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0};var c;if(goog.isFunction(a))c=a.call(goog.global,{});else if(goog.isString(a))c=goog.loadModuleFromSource_.call(goog.global,a);else throw Error("Invalid module definition");var d=goog.moduleLoaderState_.moduleName;if(!goog.isString(d)||!d)throw Error('Invalid module name "'+d+'"');goog.moduleLoaderState_.declareLegacyNamespace?
goog.constructNamespace_(d,c):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(c);goog.loadedModules_[d]=c}finally{goog.moduleLoaderState_=b}},goog.loadModuleFromSource_=function(a){eval(a);return{}},goog.writeScriptSrcNode_=function(a){goog.global.document.write('<script type="text/javascript" src="'+a+'">\x3c/script>')},goog.appendScriptSrcNode_=function(a){var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.src=a;c.defer=!1;c.async=!1;b.head.appendChild(c)},goog.writeScriptTag_=
function(a,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load');}var d=goog.IS_OLD_IE_;void 0===b?d?(d=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",c.write('<script type="text/javascript" src="'+a+'"'+d+">\x3c/script>")):goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(a):
goog.writeScriptSrcNode_(a):c.write('<script type="text/javascript">'+b+"\x3c/script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(a,b){"complete"==a.readyState&&goog.lastNonModuleScriptIndex_==b&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(a){function b(a){if(!(a in e.written||a in e.visited)){e.visited[a]=!0;if(a in e.requires)for(var f in e.requires[a])if(!goog.isProvided_(f))if(f in e.nameToPath)b(e.nameToPath[f]);else throw Error("Undefined nameToPath for "+
f);a in d||(d[a]=!0,c.push(a))}}var c=[],d={},e=goog.dependencies_;b(a);for(a=0;a<c.length;a++){var f=c[a];goog.dependencies_.written[f]=!0}var g=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(a=0;a<c.length;a++)if(f=c[a])e.pathIsModule[f]?goog.importModule_(goog.basePath+f):goog.importScript_(goog.basePath+f);else throw goog.moduleLoaderState_=g,Error("Undefined script input");goog.moduleLoaderState_=g},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:
null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")};goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);var b=new goog.global.XMLHttpRequest;b.open("get",a,!1);b.send();return b.responseText};
goog.retrieveAndExecModule_=function(a){if(!COMPILED){var b=a;a=goog.normalizePath_(a);var c=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,d=goog.loadFileSync_(a);if(null!=d)d=goog.wrapModule_(a,d),goog.IS_OLD_IE_?(goog.dependencies_.deferred[b]=d,goog.queuedModules_.push(b)):c(a,d);else throw Error("load of "+a+"failed");}};
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),"undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(d){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("SCRIPT");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));
b.body.appendChild(c);b.body.removeChild(c)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)};
goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,d){return d in b?b[d]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};
goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[c].apply(a,g)}};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_){for(var e=Array(arguments.length-1),f=1;f<arguments.length;f++)e[f-1]=arguments[f];return d.superClass_.constructor.apply(a,e)}e=Array(arguments.length-2);for(f=2;f<arguments.length;f++)e[f-2]=arguments[f];for(var f=!1,g=a.constructor;g;g=
g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(a,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return a;var c=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===c&&Object.seal(b);return b};return c}return a};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";var Lemon={BlendMode:function(a){this.alphaSourceFactor=Lemon.BlendMode.Factor.One;this.alphaDestinationFactor=Lemon.BlendMode.Factor.OneMinusSourceAlpha;this.alphaEquation=Lemon.BlendMode.Equation.Add;this.colorSourceFactor=Lemon.BlendMode.Factor.SourceAlpha;this.colorDestinationFactor=Lemon.BlendMode.Factor.OneMinusSourceAlpha;this.colorEquation=Lemon.BlendMode.Equation.Add;a&&this.setMode(a)}};Lemon.BlendMode.Mode={Alpha:0,Add:1,Multiply:2,None:3};
Lemon.BlendMode.Factor={DestinationAlpha:0,DestinationColor:1,One:2,OneMinusDestinationAlpha:3,OneMinusDestinationColor:4,OneMinusSourceAlpha:5,OneMinusSourceColor:6,SourceAlpha:7,SourceColor:8,Zero:9};Lemon.BlendMode.Equation={Add:0,Subtract:1};
Lemon.BlendMode.prototype.setMode=function(a){switch(a){case Lemon.BlendMode.Mode.Alpha:this.colorSourceFactor=Lemon.BlendMode.Factor.SourceAlpha;this.colorDestinationFactor=Lemon.BlendMode.Factor.OneMinusSourceAlpha;this.colorEquation=Lemon.BlendMode.Equation.Add;this.alphaSourceFactor=Lemon.BlendMode.Factor.One;this.alphaDestinationFactor=Lemon.BlendMode.Factor.OneMinusSourceAlpha;this.alphaEquation=Lemon.BlendMode.Equation.Add;break;case Lemon.BlendMode.Mode.Add:this.colorSourceFactor=Lemon.BlendMode.Factor.SourceAlpha;
this.colorDestinationFactor=Lemon.BlendMode.Factor.One;this.colorEquation=Lemon.BlendMode.Equation.Add;this.alphaDestinationFactor=this.alphaSourceFactor=Lemon.BlendMode.Factor.One;this.alphaEquation=Lemon.BlendMode.Equation.Add;break;case Lemon.BlendMode.Mode.Multiply:this.colorSourceFactor=Lemon.BlendMode.Factor.DestinationColor;this.colorDestinationFactor=Lemon.BlendMode.Factor.One;this.colorEquation=Lemon.BlendMode.Equation.Add;this.alphaSourceFactor=Lemon.BlendMode.Factor.One;this.alphaDestinationFactor=
Lemon.BlendMode.Factor.OneMinusSourceAlpha;this.alphaEquation=Lemon.BlendMode.Equation.Add;break;default:case Lemon.BlendMode.Mode.None:this.colorSourceFactor=Lemon.BlendMode.Factor.One,this.colorDestinationFactor=Lemon.BlendMode.Factor.Zero,this.colorEquation=Lemon.BlendMode.Equation.Add,this.alphaSourceFactor=Lemon.BlendMode.Factor.One,this.alphaDestinationFactor=Lemon.BlendMode.Factor.OneMinusSourceAlpha,this.alphaEquation=Lemon.BlendMode.Equation.Add}};
Lemon.BlendMode.prototype.isEqual=function(a){return this.alphaSourceFactor==a.alphaSourceFactor&&this.alphaDestinationFactor==a.alphaDestinationFactor&&this.alphaEquation==a.alphaEquation&&this.colorSourceFactor==a.colorSourceFactor&&this.colorDestinationFactor==a.colorDestinationFactor&&this.colorEquation==a.colorEquation};Lemon.Camera=function(a){this.direction=vec3.create();this.fov=45;this.limits=vec2.fromValues(.1,100);this.matrixProjection=mat4.create();this.matrixView=mat4.create();this.matrixViewNeedUpdate=!0;this.matrixViewProjection=mat4.create();this.matrixViewProjectionNeedUpdate=!0;this.position=vec3.fromValues(0,0,3);this.ratio=16/9;this.rotation=quat.fromValues(0,0,0,1);this.type=a||Lemon.Camera.Type.Perspective;this.viewport=vec4.create();this.zoomScale=1;this.setType(this.type)};
Lemon.Camera.Type={Perspective:0,Orthographic:1};Lemon.Camera.prototype.lookAt=function(a,b,c){vec3.set(this.direction,a,b,c);this.matrixViewNeedUpdate=!0};Lemon.Camera.prototype.move=function(a,b,c){vec3.set(this.position,a,b,c);this.matrixViewNeedUpdate=!0};
Lemon.Camera.prototype.rotate=function(a,b){function c(a,b){return[a[3]*b[0]+a[0]*b[3]+a[2]*b[1]-a[1]*b[2],a[3]*b[1]+a[1]*b[3]+a[0]*b[2]-a[2]*b[0],a[3]*b[2]+a[2]*b[3]+a[1]*b[0]-a[0]*b[1],a[3]*b[3]+a[0]*b[0]+a[1]*b[1]-a[2]*b[2]]}var d=quat.fromValues(0,0,0,1),e=quat.fromValues(0,0,0,1);quat.setAxisAngle(a,[0,1,0],d);quat.setAxisAngle(-b,[1,0,0],e);d=c(this.rotation,[this.direction[0],this.direction[1],this.direction[2],0]);e=c(this.rotation,[this.position[0],this.position[1],this.position[2],0]);vec3.set(this.direction,
d[0],d[1],d[2]);vec3.set(this.position,e[0],e[1],e[2]);this.matrixViewNeedUpdate=!0};Lemon.Camera.prototype.setFieldOfView=function(a){this.fov=a;this.setType(this.type)};Lemon.Camera.prototype.setRatio=function(a){this.ratio=a;this.setType(this.type)};
Lemon.Camera.prototype.setType=function(a){this.type=a;a==Lemon.Camera.Type.Perspective?mat4.perspective(this.matrixProjection,glMatrix.toRadian(this.fov*this.zoomScale),this.ratio,this.limits[0],this.limits[1]):mat4.ortho(this.matrixProjection,-1.5*this.ratio*this.zoomScale,1.5*this.ratio*this.zoomScale,-1.5*this.zoomScale,1.5*this.zoomScale,this.limits[0],this.limits[1]);this.matrixViewProjectionNeedUpdate=!0};Lemon.Camera.prototype.setViewDistances=function(a,b){vec2.set(this.limits,a,b);this.setType(this.type)};
Lemon.Camera.prototype.setViewport=function(a,b,c,d){vec4.set(this.viewport,a,b,c,d);this.setRatio(c/d)};Lemon.Camera.prototype.zoom=function(a){this.zoomScale=1/a;this.setType(this.type)};Lemon.Camera.prototype.getPosition=function(){return[this.position[0],this.position[1],this.position[2]]};Lemon.Camera.prototype.getProjectionMatrix=function(){return this.matrixProjection};
Lemon.Camera.prototype.getViewMatrix=function(){this.matrixViewNeedUpdate&&(mat4.lookAt(this.matrixView,this.position,this.direction,vec3.fromValues(0,1,0)),this.matrixViewNeedUpdate=!1,this.matrixViewProjectionNeedUpdate=!0);return this.matrixView};Lemon.Camera.prototype.getViewport=function(){return this.viewport};
Lemon.Camera.prototype.getViewProjectionMatrix=function(){if(this.matrixViewProjectionNeedUpdate||this.matrixViewNeedUpdate)mat4.multiply(this.matrixViewProjection,this.getProjectionMatrix(),this.getViewMatrix()),this.matrixViewProjectionNeedUpdate=!1;return this.matrixViewProjection};Lemon.Color=function(a,b,c,d){this.r=a/255;this.g=b/255;this.b=c/255;this.a=d?d/255:1};Lemon.Color.prototype.set=function(a,b,c,d){this.r=a/255;this.g=b/255;this.b=c/255;this.a=d?d/255:1};Lemon.Color.prototype.isEqual=function(a){return this.r==a.r&&this.g==a.g&&this.b==a.b&&this.a==a.a};Lemon.Private={};Lemon.Private.Context=function(){this.instance=this.domElement=null};Lemon.Private.Context.current=null;Lemon.Private.Context.Type={WebGL:0};Lemon.GetContext=function(){return Lemon.Private.Context.current.instance};
Lemon.Private.Context.prototype.init=function(a,b,c){var d=document.getElementById(c);if(!d)throw"404 - Canvas with the name "+c+" not found.";a==Lemon.Private.Context.Type.WebGL&&(this.domElement=document.createElement("canvas"),this.domElement.width=d.offsetWidth,this.domElement.height=d.offsetHeight,d.appendChild(this.domElement),this.instance=this.domElement.getContext("webgl",{antialias:b.antialiasing||!0}),this.instance.viewportWidth=this.domElement.width,this.instance.viewportHeight=this.domElement.height);
Lemon.Private.Context.current||(Lemon.Private.Context.current=this)};Lemon.Private.Context.prototype.resize=function(a,b){this.domElement&&this.instance&&(this.domElement.width=a,this.domElement.height=b,this.instance.viewportWidth=a,this.instance.viewportHeight=b)};Lemon.Private.Context.prototype.activate=function(){Lemon.Private.Context.current=this};Lemon.Private.Context.prototype.getSize=function(){return[this.domElement.width,this.domElement.height]};Lemon.Private.ContextResource=function(){this.UID=Lemon.Private.ContextResource.globalID++};Lemon.Private.ContextResource.globalID=-1;Lemon.Private.ContextResource.prototype.getUID=function(){return this.UID};Lemon.Image=function(){this.data=new Image;this.height=0;this.pixels=null;this.status=Lemon.Image.Status.Unload;this.width=0};Lemon.Image.Status={Unload:0,Loading:1,Loaded:2};Lemon.Image.prototype.loadFromFile=function(a){this.data.onload=function(){this.status=Lemon.Image.Status.Loaded;this.width=this.data.width;this.height=this.data.height;this.pixels=null}.bind(this);this.data.src=a};
Lemon.Image.prototype.create=function(a,b,c){this.pixels=c?c:new Uint8Array(a*b*4);this.data=null;this.width=a;this.height=b;this.status=Lemon.Image.Status.Loaded};Lemon.Image.prototype.getSize=function(){return[this.width,this.height]};Lemon.Image.prototype.getData=function(){return this.data||this.pixels};Lemon.Image.prototype.isReady=function(){return this.status==Lemon.Image.Status.Loaded};Lemon.Loaders={};Lemon.Loaders.FileLoader=function(){};Lemon.Loaders.FileLoader.load=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4!==d.readyState||200!==d.status&&0!==d.status||b(!0,d.responseText,c)};d.open("GET",a,!0);d.send()};Lemon.WebGLObjects={};Lemon.WebGLObjects.BufferData=function(){this.indexBuffer=null;this.vertexBuffers=[];this.vao=null};Lemon.WebGLObjects.Instances=function(){this.buffers=[];this.frameBuffers=[];this.programs=[];this.textures=[]};Lemon.StateBlock=function(){this.blendMode=new Lemon.BlendMode;this.depthFunction=Lemon.DepthFunction.Less;this.depthTest=this.depthWrite=!0;this.drawingMode=Lemon.DrawingMode.Triangles;this.faceCulling=Lemon.FaceCulling.Back;this.stencilFunction=Lemon.StencilFunction.Less;this.stencilReference=0;this.stencilMask=255;this.stencilTest=!1;this.stencilWrite=255;this.stencilSuccess=this.stencilDepthTestFail=this.stencilTestFail=Lemon.StencilOperation.Keep};
Lemon.DepthFunction={Never:0,Less:1,Equal:2,LessEqual:3,Greater:4,NotEqual:5,GreaterEqual:6,Always:7};Lemon.DrawingMode={Points:0,Lines:1,LinesStrip:2,LinesLoop:3,Triangles:4,TrianglesStrip:5,TrianglesFan:6};Lemon.FaceCulling={Back:0,Front:1,None:2};Lemon.StencilFunction={Never:0,Less:1,Equal:2,LessEqual:3,Greater:4,NotEqual:5,GreaterEqual:6,Always:7};Lemon.StencilOperation={Keep:0,Zero:1,Replace:2,Increment:3,Decrement:4,Invert:5,IncrementWrap:6,DecrementWrap:7};
Lemon.StateBlock.prototype.isEqual=function(a){return this.blendMode.isEqual(a.blendMode)&&this.depthFunction==a.depthFunction&&this.depthWrite==a.depthWrite&&this.depthTest==a.depthTest&&this.stencilFunction==a.stencilFunction&&this.stencilReference==a.stencilReference&&this.stencilMask==a.stencilMask&&this.stencilTest==a.stencilTest&&this.stencilWrite==a.stencilWrite&&this.stencilTestFail==a.stencilTestFail&&this.stencilDepthTestFail==a.stencilDepthTestFail&&this.stencilSuccess==a.stencilSuccess};Lemon.TextureCube=function(){Lemon.Private.ContextResource.call(this);this.images=[]};goog.inherits(Lemon.TextureCube,Lemon.Private.ContextResource);Lemon.TextureCube.Face={Up:0,Down:1,Left:2,Right:3,Back:4,Front:5};Lemon.TextureCube.prototype.loadFromFiles=function(a){for(var b in a){var c=new Lemon.Image;c.loadFromFile(a[b]);this.images[b]=c}};Lemon.TextureCube.prototype.getImages=function(){return this.images};
Lemon.TextureCube.prototype.isReady=function(){if(0===this.images.length)return!1;for(var a=0;a<this.images.length;a++)if(!this.images[a].isReady())return!1;return!0};Lemon.Private.TextureInterface=function(){Lemon.Private.ContextResource.call(this);this.ready=!1;this.mipmap=!0};goog.inherits(Lemon.Private.TextureInterface,Lemon.Private.ContextResource);Lemon.Private.TextureInterface.prototype.isReady=function(){return this.ready};Lemon.Private.TextureInterface.prototype.isMipmaped=function(){return this.mipmap};Lemon.Private.TextureInterface.prototype.isRepeated=function(){return!1};Lemon.Private.TextureInterface.prototype.isSmoothed=function(){return!1};
Lemon.Private.TextureInterface.prototype.useMipmap=function(a){this.mipmap=a};Lemon.Texture=function(){Lemon.Private.TextureInterface.call(this);this.image=null;this.smooth=this.repeat=!0};goog.inherits(Lemon.Texture,Lemon.Private.TextureInterface);Lemon.Texture.prototype.loadFromFile=function(a){this.image=new Lemon.Image;this.image.loadFromFile(a)};Lemon.Texture.prototype.loadFromImage=function(a){this.image=a};Lemon.Texture.prototype.setRepeated=function(a){this.repeat=a};Lemon.Texture.prototype.setSmooth=function(a){this.smooth=a};Lemon.Texture.prototype.getImage=function(){return this.image};
Lemon.Texture.prototype.isReady=function(){if(!this.image)return!1;var a=this.image.getSize();return 0===a[0]||0===a[1]?!1:!0};Lemon.Texture.prototype.isRepeated=function(){return this.repeat};Lemon.Texture.prototype.isSmoothed=function(){return this.smooth};Lemon.TextureVideo=function(){Lemon.Private.TextureInterface.call(this);this.data=document.createElement("video")};goog.inherits(Lemon.TextureVideo,Lemon.Private.TextureInterface);Lemon.TextureVideo.prototype.loadFromFile=function(a){this.data.addEventListener("canplaythrough",function(){this.ready=!0}.bind(this),!0);this.data.preload="auto";this.data.src=a};Lemon.TextureVideo.prototype.pause=function(){this.data.pause()};Lemon.TextureVideo.prototype.play=function(){this.data.play()};
Lemon.TextureVideo.prototype.getDuration=function(){return this.data.duration};Lemon.TextureVideo.prototype.getVideoData=function(){return this.data};Lemon.Transformable=function(){this.matrix=mat4.create();this.normalMatrix=mat4.create();this.origin=vec3.create();this.position=vec3.create();this.rotation=quat.create();this.rotationMatrix=mat4.create();this.scale=vec3.fromValues(1,1,1);this.needTransformUpdate=!0};
Lemon.Transformable.prototype.lookAt=function(a,b){a=a||[0,0,0];b=b||[0,1,0];var c=vec3.create(),d=vec3.create(),e=vec3.create();vec3.subtract(e,a,this.position);vec3.normalize(e,e);vec3.subtract(e,a,this.position);vec3.normalize(e,e);vec3.cross(c,b,e);vec3.normalize(c,c);vec3.cross(d,e,c);var f=mat4.create();f[0]=c[0];f[1]=c[1];f[2]=c[2];f[3]=0;f[4]=d[0];f[5]=d[1];f[6]=d[2];f[7]=0;f[8]=e[0];f[9]=e[1];f[10]=e[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;this.setRotationFromMatrix(f)};
Lemon.Transformable.prototype.setOrigin=function(a,b,c){vec3.set(this.origin,a,b,c);this.needTransformUpdate=!0};Lemon.Transformable.prototype.setPosition=function(a,b,c){vec3.set(this.position,a,b,c);this.needTransformUpdate=!0};
Lemon.Transformable.prototype.setRotation=function(a,b,c){mat4.identity(this.rotationMatrix);mat4.rotateX(this.rotationMatrix,this.rotationMatrix,glMatrix.toRadian(a));mat4.rotateY(this.rotationMatrix,this.rotationMatrix,glMatrix.toRadian(b));mat4.rotateZ(this.rotationMatrix,this.rotationMatrix,glMatrix.toRadian(c));a=mat3.create();mat3.fromMat4(a,this.rotationMatrix);quat.fromMat3(this.rotation,a);this.needTransformUpdate=!0};
Lemon.Transformable.prototype.setRotationFromQuaternion=function(a){mat4.fromQuat(this.rotationMatrix,a);this.rotation=a;this.needTransformUpdate=!0};Lemon.Transformable.prototype.setRotationFromMatrix=function(a){quat.fromMat3(this.rotation,a);this.rotationMatrix=a;this.needTransformUpdate=!0};Lemon.Transformable.prototype.setScale=function(a,b,c){vec3.set(this.scale,a,b,c);this.needTransformUpdate=!0};
Lemon.Transformable.prototype.computeTransformationMatrix=function(a,b){if(!b&&!this.needTransformUpdate)return!1;mat4.identity(this.matrix);mat4.translate(this.matrix,this.matrix,this.position);mat4.multiply(this.matrix,this.matrix,this.rotationMatrix);mat4.scale(this.matrix,this.matrix,this.scale);a&&mat4.multiply(this.matrix,a,this.matrix);mat4.invert(this.normalMatrix,this.matrix);mat4.transpose(this.normalMatrix,this.normalMatrix);this.needTransformUpdate=!1;return!0};
Lemon.Transformable.prototype.getTransformationMatrix=function(){return this.matrix};Lemon.Transformable.prototype.getNormalMatrix=function(){return this.normalMatrix};Lemon.Transformable.prototype.getOrigin=function(){return this.origin};Lemon.Transformable.prototype.getPosition=function(){return this.position};Lemon.Transformable.prototype.getRotation=function(){throw"'getRotation' is not implemented for now \u2026";};Lemon.Transformable.prototype.getScale=function(){return this.scale};Lemon.Node=function(a){Lemon.Transformable.call(this);this.children=[];this.name=a||"";this.parent=null};goog.inherits(Lemon.Node,Lemon.Transformable);Lemon.Node.prototype.addChild=function(a){a!=this&&(a.parent&&a.parent.removeChild(a),this.children.push(a),a.parent=this)};Lemon.Node.prototype.findChild=function(a){for(var b=0;b<this.children.length;b++){if(this.children[b].name==a)return this.children[b];var c=this.children[b].findChild(a);if(c)return c}return null};
Lemon.Node.prototype.removeChild=function(a){var b=this.children.indexOf(a);return-1!=b?(this.children.splice(b,1),a.parent=null,!0):!1};Lemon.Node.prototype.setName=function(a){this.name=a};Lemon.Node.prototype.update=function(a,b){var c=this.parent?this.parent.getTransformationMatrix():null;return this.computeTransformationMatrix(c,b)};Lemon.Node.prototype.visit=function(a){};Lemon.Node.prototype.getChildren=function(){return this.children};Lemon.Node.prototype.isRoot=function(){return null===this.parent};Lemon.Light=function(){Lemon.Node.call(this);this.ambient=new Lemon.Color(255,255,255);this.diffuse=new Lemon.Color(255,255,255);this.specular=new Lemon.Color(255,255,255)};goog.inherits(Lemon.Light,Lemon.Node);Lemon.Light.prototype.visit=function(a){a.getRenderAPI().bindLight(this)};Lemon.Light.prototype.setAmbientColor=function(a,b,c){this.ambient.set(a,b,c)};Lemon.Light.prototype.setDiffuseColor=function(a,b,c){this.diffuse.set(a,b,c)};
Lemon.Light.prototype.setSpecularColor=function(a,b,c){this.specular.set(a,b,c)};Lemon.Light.prototype.getAmbientColor=function(){return this.ambient};Lemon.Light.prototype.getDiffuseColor=function(){return this.diffuse};Lemon.Light.prototype.getSpecularColor=function(){return this.specular};Lemon.DirectionalLight=function(){Lemon.Light.call(this);this.direction=[]};goog.inherits(Lemon.DirectionalLight,Lemon.Light);Lemon.DirectionalLight.prototype.setDirection=function(a,b,c){this.direction=[a,b,c]};Lemon.DirectionalLight.prototype.getDirection=function(){return this.direction};Lemon.PointLight=function(){Lemon.Light.call(this);this.constant=1;this.linear=.09;this.quadratic=.032};goog.inherits(Lemon.PointLight,Lemon.Light);Lemon.PointLight.prototype.setValues=function(a,b,c){this.constant=a;this.linear=b;this.quadratic=c};Lemon.PointLight.prototype.getValues=function(){return[this.constant,this.linear,this.quadratic]};Lemon.SpotLight=function(){Lemon.Light.call(this);this.constant=1;this.cutoff=12.5;this.direction=[];this.linear=.09;this.quadratic=.032};goog.inherits(Lemon.SpotLight,Lemon.Light);Lemon.SpotLight.prototype.setDirection=function(a,b,c){this.direction=[a,b,c]};Lemon.SpotLight.prototype.setCutoff=function(a){this.cutoff=a};Lemon.SpotLight.prototype.setValues=function(a,b,c){this.constant=a;this.linear=b;this.quadratic=c};Lemon.SpotLight.prototype.getDirection=function(){return this.direction};
Lemon.SpotLight.prototype.getValues=function(){return[this.constant,this.linear,this.quadratic]};Lemon.Drawable=function(){Lemon.Node.call(this)};goog.inherits(Lemon.Drawable,Lemon.Node);Lemon.Drawable.prototype.draw=function(a){};Lemon.Drawable.prototype.visit=function(a){this.draw(a)};Lemon.WebGL={};Lemon.WebGL.Cache=function(){this.clearColor=new Lemon.Color(1,1,1,255);this.vertexFormat=this.texture=this.program=null;this.lights=[];this.lightsAmbient=[];this.lightsDiffuse=[];this.lightsData=[];this.lightsDirection=[];this.lightsPosition=[];this.lightsSpecular=[];this.lightsType=[]};Lemon.Scene=function(){this.root=new Lemon.Node("root")};Lemon.Scene.prototype.add=function(a){this.root.addChild(a)};Lemon.Scene.prototype.find=function(a){return this.root.findChild(a)};Lemon.Scene.prototype.remove=function(a){return this.root.removeChild(a)};Lemon.Scene.prototype.update=function(a){function b(a,d,e){var f=a.update(d,e);a=a.getChildren();for(var g=0;g<a.length;g++)b(a[g],d,f||e)}b(this.root,a,!1)};
Lemon.Scene.prototype.visit=function(a){function b(a,d){a.visit(d);for(var e=a.getChildren(),f=0;f<e.length;f++)b(e[f],d)}b(this.root,a)};Lemon.Type={Float:0,Int:1,Bool:2,Matrix:3,Texture2D:4,TextureCube:5,Byte:6,u_Byte:7,Short:8,u_Short:9,u_Int:10};Lemon.Program=function(){Lemon.Private.ContextResource.call(this);this.attributes=[];this.sources=[null,null];this.uniforms=[]};goog.inherits(Lemon.Program,Lemon.Private.ContextResource);Lemon.Program.Element=function(a,b,c,d){this.location=a;this.name=b;this.type=c;this.size=d};Lemon.Program.prototype.loadFromFiles=function(a,b){Lemon.Loaders.FileLoader.load(a,function(a,b){this.sources[0]=b}.bind(this));Lemon.Loaders.FileLoader.load(b,function(a,b){this.sources[1]=b}.bind(this))};
Lemon.Program.prototype.loadFromData=function(a,b){this.sources[0]=a;this.sources[1]=b};Lemon.Program.prototype.getAttributes=function(){return this.attributes};Lemon.Program.prototype.getSources=function(){return this.sources};Lemon.Program.prototype.getUniform=function(a){return this.uniforms[a]||null};Lemon.Program.prototype.getUniforms=function(){return this.uniforms};Lemon.Program.prototype.isReady=function(){return 2===this.sources.length&&null!==this.sources[0]&&null!==this.sources[1]};Lemon.ProgramLibrary=function(){};Lemon.ProgramLibrary.cache=[];Lemon.ProgramLibrary.chunks=[];Lemon.ProgramLibrary.folderPath="../shaders/";Lemon.ProgramLibrary.programs=[];Lemon.ProgramLibrary.Target={Vertex:0,Fragment:1};Lemon.ProgramLibrary.get=function(a){var b=Lemon.ProgramLibrary.programs[a];b||(b=new Lemon.Program,Lemon.ProgramLibrary.programs[a]=b);return b};
Lemon.ProgramLibrary.load=function(a,b,c,d){var e=Lemon.ProgramLibrary.get(a),f=/include\[([^\]]*)\]/g;Lemon.ProgramLibrary.cache[a]={data:null,ready:!1,sources:[]};var g=function(a,b,c){Lemon.ProgramLibrary.chunks[c].data=b;Lemon.ProgramLibrary.chunks[c].ready=!0;Lemon.ProgramLibrary.tryUpdateWaitingPrograms()},h=function(b,c,d){c=Lemon.ProgramLibrary.programs[a];var e=c.getSources(),h=d.match(f);if(h){for(var r=h.length,p=0;p<h.length;p++){var n=h[p],n=n.substring(n.lastIndexOf("[")+1,n.lastIndexOf("]"));
Lemon.ProgramLibrary.chunks[n]&&Lemon.ProgramLibrary.chunks[n].ready?r--:Lemon.ProgramLibrary.chunks[n]||(Lemon.ProgramLibrary.chunks[n]={data:"",ready:!1},Lemon.Loaders.FileLoader.load(Lemon.ProgramLibrary.folderPath+n+"?"+(new Date).getTime(),g,n))}d=Lemon.ProgramLibrary.replaceChunks(d);0===r&&Lemon.ProgramLibrary.fillProgram(e,c,a,b,d||"")}else Lemon.ProgramLibrary.fillProgram(e,c,a,b,d)};Lemon.Loaders.FileLoader.load(Lemon.ProgramLibrary.folderPath+b+"?"+(new Date).getTime(),function(b,c){c=
Lemon.ProgramLibrary.addDefines(c,d||[]);Lemon.ProgramLibrary.cache[a].sources[0]=c;h(Lemon.ProgramLibrary.Target.Vertex,a,c)});Lemon.Loaders.FileLoader.load(Lemon.ProgramLibrary.folderPath+c+"?"+(new Date).getTime(),function(b,c){c=Lemon.ProgramLibrary.addDefines(c,d||[]);Lemon.ProgramLibrary.cache[a].sources[1]=c;h(Lemon.ProgramLibrary.Target.Fragment,a,c)});return e};
Lemon.ProgramLibrary.fillProgram=function(a,b,c,d,e){d==Lemon.ProgramLibrary.Target.Vertex?b.loadFromData(e,a[1]):b.loadFromData(a[0],e);b.isReady()&&delete Lemon.ProgramLibrary.cache[c]};
Lemon.ProgramLibrary.tryUpdateWaitingPrograms=function(){for(var a in Lemon.ProgramLibrary.programs)if(!Lemon.ProgramLibrary.programs[a].isReady())for(var b=Lemon.ProgramLibrary.programs[a].getSources(),c=0;2>c;c++)if(!b[c]){var d=Lemon.ProgramLibrary.replaceChunks(Lemon.ProgramLibrary.cache[a].sources[c]);d&&Lemon.ProgramLibrary.fillProgram(b,Lemon.ProgramLibrary.programs[a],a,0===c?Lemon.ProgramLibrary.Target.Vertex:Lemon.ProgramLibrary.Target.Fragment,d)}};
Lemon.ProgramLibrary.replaceChunks=function(a){for(var b=/include\[([^\]]*)\]/;b.test(a);){var c=a.match(b),d=c[0].substring(c[0].lastIndexOf("[")+1,c[0].lastIndexOf("]"));if(!Lemon.ProgramLibrary.chunks[d]||!Lemon.ProgramLibrary.chunks[d].ready)return null;a=a.replace(c[0],Lemon.ProgramLibrary.chunks[d].data||"")}return a};Lemon.ProgramLibrary.addDefines=function(a,b){if(!b)return a;for(var c="",d=0;d<b.length;d++)c+="#define "+b[d]+"\n";return c+a};Lemon.PassParameter=function(a,b,c){this.name=a;this.type=b;this.value=c};Lemon.Pass=function(){Lemon.StateBlock.call(this);this.parameters=[]};goog.inherits(Lemon.Pass,Lemon.StateBlock);Lemon.Pass.prototype.add=function(a,b,c){for(var d=0;d<this.parameters.length;d++)if(this.parameters[d].name==a){this.parameters[d].value=c;this.parameters[d].type=b;return}this.parameters.push(new Lemon.PassParameter(a,b,c))};
Lemon.Pass.prototype.set=function(a,b){for(var c=0;c<this.parameters.length;c++)if(this.parameters[c].name==a){this.parameters[c].value=b;break}};Lemon.Pass.prototype.getParameters=function(){return this.parameters};Lemon.Material=function(){this.activeTechnique=0;this.techniques=[];this.createTechnique()};Lemon.Material.create=function(a){var b=new Lemon.Material,c=b.createPass();"default"==a&&(c.add("material.ambient",Lemon.Type.Float,[0,0,0]),c.add("material.diffuse",Lemon.Type.Float,[.55,.55,.55]),c.add("material.specular",Lemon.Type.Float,[.7,.7,.7]),c.add("material.shininess",Lemon.Type.Float,38.4));return b};
Lemon.Material.prototype.createPass=function(a){var b=new Lemon.Pass;this.techniques[a||0].push(b);return b};Lemon.Material.prototype.createTechnique=function(){this.techniques.push([]);return this.techniques.length-1};Lemon.Material.prototype.setActiveTechnique=function(a){this.activeTechnique=a};Lemon.Material.prototype.getActiveTechnique=function(){return this.activeTechnique};Lemon.Material.prototype.getPass=function(a,b){return a>=this.techniques.length?null:this.techniques[a][b]||null};
Lemon.Material.prototype.getPassCount=function(a){return a>=this.techniques.length?0:this.techniques[a].length};Lemon.VertexElement=function(a,b,c,d,e){this.count=d||0;this.normalize=e||!1;this.offset=0;this.stream=b;this.stride=0;this.type=c;this.usage=a};Lemon.VertexElement.StreamType={Static:0,Dynamic:1,Stream:2};Lemon.VertexElement.Type={Byte:0,Float:1,Int:2,Short:3};Lemon.VertexElement.Usage={Position:0,Color:1,UVS:2,Normal:3,Tangent:4};Lemon.VertexFormat=function(){this.elements=[];this.streamType=[];this.streamStride=[];this.streamNeedUpdate=[];this.indicesNeedUpdate=!0};
Lemon.VertexFormat.prototype.add=function(a){this.elements.push(a);this.compute()};Lemon.VertexFormat.prototype.set=function(a){this.elements=a;this.compute()};Lemon.VertexFormat.prototype.setStreamType=function(a,b){this.streamType[a]=b};
Lemon.VertexFormat.prototype.compute=function(){var a=0,b=0,b=0;this.elements.sort(function(a,b){return a.stream<b.stream?-1:a.stream>b.stream?1:0});for(var c=0;c<this.elements.length;c++){b!=this.elements[c].stream&&(this.streamStride[b]=a,a=0);switch(this.elements[c].type){case Lemon.VertexElement.Type.Float:case Lemon.VertexElement.Type.Int:b=4;break;case Lemon.VertexElement.Type.Short:b=2;break;case Lemon.VertexElement.Type.Byte:b=1;break;default:b=1}this.elements[c].offset=a;b*=this.elements[c].count;
a+=b;b=this.elements[c].stream}this.streamStride[b]=a};Lemon.VertexFormat.prototype.setIndicesAsWaitingUpdate=function(a){this.indicesNeedUpdate=a};Lemon.VertexFormat.prototype.setStreamAsWaitingUpdate=function(a,b){for(var c=0;c<this.elements.length;c++)this.elements[c].usage==a&&(this.streamNeedUpdate[this.elements[c].stream]=b)};Lemon.VertexFormat.prototype.getElements=function(){return this.elements};Lemon.VertexFormat.prototype.getStreamStride=function(a){return this.streamStride[a]||0};
Lemon.VertexFormat.prototype.getStreamType=function(a){return this.streamType[a]||Lemon.VertexElement.StreamType.Stream};Lemon.VertexFormat.prototype.isIndicesWaitingUpdate=function(){return this.indicesNeedUpdate};Lemon.VertexFormat.prototype.isStreamWaitingUpdate=function(a){return this.streamNeedUpdate[a]};Lemon.Geometry=function(){Lemon.Private.ContextResource.call(this);this.vertexFormat=this.uvs=this.positions=this.normals=this.indices=this.colors=null};goog.inherits(Lemon.Geometry,Lemon.Private.ContextResource);Lemon.Geometry.prototype.setColors=function(a){this.colors=new Float32Array(a);this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(Lemon.VertexElement.Usage.Color,!0)};Lemon.Geometry.prototype.setIndices=function(a){this.indices=new Uint16Array(a);this.vertexFormat&&this.vertexFormat.setIndicesAsWaitingUpdate(!0)};
Lemon.Geometry.prototype.setNormals=function(a){this.normals=new Float32Array(a);this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(Lemon.VertexElement.Usage.Normal,!0)};Lemon.Geometry.prototype.setPositions=function(a){this.positions=new Float32Array(a);this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(Lemon.VertexElement.Usage.Position,!0)};
Lemon.Geometry.prototype.setTextureUVs=function(a){this.uvs=new Float32Array(a);this.vertexFormat&&this.vertexFormat.setStreamAsWaitingUpdate(Lemon.VertexElement.Usage.UVS,!0)};Lemon.Geometry.prototype.setVertexFormat=function(a){this.vertexFormat=a};Lemon.Geometry.prototype.getVertexFormat=function(){return this.vertexFormat};Lemon.Geometry.prototype.getIndexCount=function(){return this.indices.length};Lemon.Geometry.prototype.getIndices=function(){return this.indices};
Lemon.Geometry.prototype.getVerticesColors=function(){return this.colors};Lemon.Geometry.prototype.getVerticesPositions=function(){return this.positions};Lemon.Geometry.prototype.getVerticesNormals=function(){return this.normals};Lemon.Geometry.prototype.getVerticesUVs=function(){return this.uvs};
Lemon.Geometry.createCube=function(a,b,c){var d=new Lemon.Geometry,e=new Lemon.VertexFormat;e.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Position,0,Lemon.VertexElement.Type.Float,3,!1));e.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Color,2,Lemon.VertexElement.Type.Float,4,!1));e.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.UVS,1,Lemon.VertexElement.Type.Float,2,!1));e.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Normal,3,Lemon.VertexElement.Type.Float,3,!1));
d.setVertexFormat(e);a=new Float32Array([-a,-b,c,a,-b,c,a,b,c,-a,b,c,-a,-b,-c,-a,b,-c,a,b,-c,a,-b,-c,-a,b,-c,-a,b,c,a,b,c,a,b,-c,-a,-b,-c,a,-b,-c,a,-b,c,-a,-b,c,a,-b,-c,a,b,-c,a,b,c,a,-b,c,-a,-b,-c,-a,-b,c,-a,b,c,-a,b,-c]);d.setPositions(a);a=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);d.setColors(a);a=new Float32Array([0,0,1,0,1,1,
0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]);d.setTextureUVs(a);a=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);d.setNormals(a);a=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);d.setIndices(a);return d};
Lemon.Geometry.createRectangle=function(a,b){var c=new Lemon.Geometry,d=new Lemon.VertexFormat;d.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Position,0,Lemon.VertexElement.Type.Float,3,!1));d.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Color,1,Lemon.VertexElement.Type.Float,4,!1));d.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.UVS,2,Lemon.VertexElement.Type.Float,2,!1));d.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Normal,3,Lemon.VertexElement.Type.Float,3,!1));
c.setVertexFormat(d);d=new Float32Array([-a,-b,0,-a,b,0,a,-b,0,a,b,0]);c.setPositions(d);d=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);c.setColors(d);d=new Float32Array([0,1,0,0,1,1,1,0]);c.setTextureUVs(d);d=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);c.setNormals(d);c.setIndices(new Uint16Array([0,2,1,3]));return c};Lemon.RenderAPI=function(){this.activeCamera=null};Lemon.RenderAPI.prototype.bindLight=function(a){};Lemon.RenderAPI.prototype.applyStateBlock=function(a){this.setBlendMode(a.blendMode);this.setDepthState(a.depthTest,a.depthWrite,a.depthFunction);this.setFaceCulling(a.faceCulling);this.setStencilState(a.stencilTest,a.stencilWrite);this.setStencilFunction(a.stencilFunction,a.stencilReference,a.stencilMask);this.setStencilOperations(a.stencilTestFail,a.stencilDepthTestFail,a.stencilSuccess)};
Lemon.RenderAPI.prototype.bindFrameBuffer=function(a){};Lemon.RenderAPI.prototype.bindTexture=function(a,b){};Lemon.RenderAPI.prototype.bindTextureCube=function(a,b){};Lemon.RenderAPI.prototype.clear=function(a){};Lemon.RenderAPI.prototype.clearCache=function(){};Lemon.RenderAPI.prototype.createFrameBuffer=function(){return 0};Lemon.RenderAPI.prototype.drawIndexedPrimitives=function(a,b,c){};Lemon.RenderAPI.prototype.drawPrimitives=function(a,b,c){};
Lemon.RenderAPI.prototype.initFrameBuffer=function(a,b,c,d){};Lemon.RenderAPI.prototype.setActiveCamera=function(a){this.activeCamera=a};Lemon.RenderAPI.prototype.setBlendMode=function(a){};Lemon.RenderAPI.prototype.setDepthState=function(a,b,c){};Lemon.RenderAPI.prototype.setFaceCulling=function(a){};Lemon.RenderAPI.prototype.setGeometry=function(a){};Lemon.RenderAPI.prototype.setIndexBuffer=function(a){};Lemon.RenderAPI.prototype.setProgram=function(a){return-1};
Lemon.RenderAPI.prototype.setUniform=function(a,b,c,d,e){return!1};Lemon.RenderAPI.prototype.setScissorTest=function(a,b,c,d,e){};Lemon.RenderAPI.prototype.setStencilState=function(a,b){};Lemon.RenderAPI.prototype.setStencilFunction=function(a,b,c){};Lemon.RenderAPI.prototype.setStencilOperations=function(a,b,c){};Lemon.RenderAPI.prototype.setVertexBuffer=function(a,b){};Lemon.RenderAPI.prototype.setVertexFormat=function(a){};Lemon.RenderAPI.prototype.getActiveCamera=function(){return this.activeCamera};Lemon.RenderCommand=function(){};Lemon.RenderCommand.prototype.isOpaque=function(){return!0};Lemon.RenderCommand.prototype.execute=function(a){};Lemon.MeshCommand=function(a,b,c,d,e,f,g){Lemon.RenderCommand.call(this);this.endVertex=g;this.geometry=a;this.modelMatrix=d;this.normalMatrix=e;this.pass=b;this.program=c;this.startVertex=f};goog.inherits(Lemon.MeshCommand,Lemon.RenderCommand);
Lemon.MeshCommand.prototype.execute=function(a){var b=a.setProgram(this.program);if(-1!=b){1==b&&a.setUniform(this.program,"uCamera",Lemon.Type.Matrix,a.getActiveCamera().getViewProjectionMatrix());a.setUniform(this.program,"uModel",Lemon.Type.Matrix,this.modelMatrix);a.setUniform(this.program,"uModelNormal",Lemon.Type.Matrix,this.normalMatrix);a.applyStateBlock(this.pass);for(var b=this.pass.getParameters(),c=0,d=0;d<b.length;d++){var e=b[d];switch(e.type){case Lemon.Type.Texture2D:a.setUniform(this.program,
e.name,Lemon.Type.Int,c);a.bindTexture(c,e.value);c++;break;default:a.setUniform(this.program,e.name,e.type,e.value)}}a.setGeometry(this.geometry);a.drawIndexedPrimitives(this.pass.drawingMode,this.startVertex,this.endVertex)}};Lemon.Mesh=function(){Lemon.Drawable.call(this);this.program=this.material=this.geometry=null};goog.inherits(Lemon.Mesh,Lemon.Drawable);Lemon.Mesh.prototype.draw=function(a){if(this.geometry&&this.material&&this.program){a=a.getActiveTask();for(var b=this.material.getActiveTechnique(),c=this.material.getPassCount(b),d=0;d<c;d++)a.addCommand(new Lemon.MeshCommand(this.geometry,this.material.getPass(b,d),this.program,this.getTransformationMatrix(),this.getNormalMatrix(),0,this.geometry.getIndexCount()))}};
Lemon.Mesh.prototype.setGeometry=function(a){this.geometry=a};Lemon.Mesh.prototype.setMaterial=function(a){this.material=a};Lemon.Mesh.prototype.setProgram=function(a){this.program=a};Lemon.Mesh.prototype.getProgram=function(){return this.program};Lemon.Loaders.ModelLoader=function(){};Lemon.Loaders.ModelLoader.loadFromFile=function(a,b){Lemon.Loaders.FileLoader.load(a,function(a,b,e){a=e.filePath.replace(/[^\/]*$/,"");Lemon.Loaders.ModelLoader.parse(b,e.model,a)},{model:b,filePath:a})};
Lemon.Loaders.ModelLoader.parse=function(a,b,c){c=c||"";a=JSON.parse(a);var d=[],e,f,g;for(e=0;e<a.materials.length;e++){var h=new Lemon.Material,l=h.createPass();l.drawingMode=Lemon.DrawingMode.Triangles;g=a.materials[e].properties;for(f=0;f<g.length;f++){var k=g[f];if(1==k.type)"$mat.twosided"==k.key&&1==k.value?l.faceCulling=Lemon.FaceCulling.None:"$mat.shininess"==k.key?l.add("material.shininess",Lemon.Type.Float,k.value):"$clr.ambient"==k.key?l.add("material.ambient",Lemon.Type.Float,[k.value[0],
k.value[1],k.value[2]]):"$clr.diffuse"==k.key?l.add("material.diffuse",Lemon.Type.Float,[k.value[0],k.value[1],k.value[2]]):"$clr.specular"==k.key?l.add("material.specular",Lemon.Type.Float,[k.value[0],k.value[1],k.value[2]]):"$clr.emissive"==k.key&&l.add("material.emissive",Lemon.Type.Float,[k.value[0],k.value[1],k.value[2]]);else if(3==k.type&&"?mat.name"!=k.key){var q=new Lemon.Texture;q.loadFromFile(c+k.value);var m="material.diffuseTexture";switch(k.semantic){default:case 1:m="material.diffuseTexture";
break;case 2:m="material.specularTexture";break;case 3:m="material.ambientTexture";break;case 4:m="material.emissiveTexture";break;case 5:m="material.heightTexture";break;case 6:m="material.normalsTexture";break;case 7:m="material.shininessTexture";break;case 8:m="material.opacityTexture";break;case 9:m="material.displacementTexture"}l.add(m,Lemon.Type.Texture2D,q)}}d.push(h)}for(e=0;e<a.meshes.length;e++){c=new Lemon.Mesh;b.meshes.push(c);h=a.meshes[e];l=new Lemon.Geometry;f=new Lemon.VertexFormat;
l.setVertexFormat(f);g=new Float32Array(h.vertices);f.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Position,0,Lemon.VertexElement.Type.Float,3,!1));l.setPositions(g);g=new Float32Array(h.normals);f.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.Normal,1,Lemon.VertexElement.Type.Float,3,!1));l.setNormals(g);h.texturecoords&&(g=new Float32Array(h.texturecoords[0]),f.add(new Lemon.VertexElement(Lemon.VertexElement.Usage.UVS,2,Lemon.VertexElement.Type.Float,h.numuvcomponents[0],!1)),l.setTextureUVs(g));
k=new Uint16Array(3*h.faces.length);for(g=f=0;f<h.faces.length;f++,g+=3)k[g+0]=h.faces[f][0],k[g+1]=h.faces[f][1],k[g+2]=h.faces[f][2];l.setIndices(k);c.setGeometry(l);void 0!==h.materialindex&&d[h.materialindex]?c.setMaterial(d[h.materialindex]):(h=new Lemon.Material,l=h.createPass(),l.drawingMode=Lemon.DrawingMode.Triangles,l.add("material.ambient",Lemon.Type.Float,[0,0,0]),l.add("material.diffuse",Lemon.Type.Float,[.55,.55,.55]),l.add("material.specular",Lemon.Type.Float,[.7,.7,.7]),l.add("material.shininess",
Lemon.Type.Float,38.4),c.setMaterial(h));c.setProgram(Lemon.ProgramLibrary.get("PhongShader"))}};Lemon.Model=function(){Lemon.Drawable.call(this);this.meshes=[]};goog.inherits(Lemon.Model,Lemon.Drawable);Lemon.Model.prototype.update=function(a,b){for(var c=Lemon.Node.prototype.update.call(this,a,b),d=0;d<this.meshes.length;d++)this.meshes[d].computeTransformationMatrix(this.getTransformationMatrix(),c);return c};Lemon.Model.prototype.draw=function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].draw(a)};
Lemon.Model.prototype.loadFromFile=function(a){Lemon.Loaders.ModelLoader.loadFromFile(a,this)};Lemon.SpriteCommand=function(a){Lemon.RenderCommand.call(this);this.sprite=a};goog.inherits(Lemon.SpriteCommand,Lemon.RenderCommand);Lemon.SpriteCommand.sharedGeometry=Lemon.Geometry.createRectangle(.5,.5);Lemon.SpriteCommand.sharedProgram=new Lemon.Program;Lemon.SpriteCommand.prototype.execute=function(a){Lemon.SpriteCommand.draw(a,this.sprite)};
Lemon.SpriteCommand.draw=function(a,b){var c=b.getTexture();if(c.isReady()){var d=b.getCustomProgram();if(!d)if(Lemon.SpriteCommand.isDefaultProgramLoaded())d=Lemon.SpriteCommand.sharedProgram;else return;var e=a.setProgram(d);if(-1!==e){var f=b.getTextureRect(),g=b.getSize();1===e&&a.setUniform(d,"uCamera",Lemon.Type.Matrix,a.getActiveCamera().getViewProjectionMatrix());a.setUniform(d,"uModel",Lemon.Type.Matrix,b.getTransformationMatrix());a.setBlendMode(b.getBlendMode());a.setDepthState(!0,!0,Lemon.DepthFunction.Less);
a.bindTexture(0,c);d=null;if(c instanceof Lemon.TextureVideo)d=new Float32Array([0,1,0,0,1,1,1,0]);else{var h=c.getImage().getSize(),c=f[0]/h[0],d=(f[1]+f[3])/h[1],e=(f[0]+f[2])/h[0],h=f[1]/h[1];0===f[2]&&0===f[3]&&(e=h=1);d=new Float32Array([c,h,c,d,e,h,e,d])}Lemon.SpriteCommand.sharedGeometry.setTextureUVs(d);f=b.getColor();f=new Float32Array([f.r,f.g,f.b,f.a,f.r,f.g,f.b,f.a,f.r,f.g,f.b,f.a,f.r,f.g,f.b,f.a]);Lemon.SpriteCommand.sharedGeometry.setColors(f);g=new Float32Array([-g[0],-g[1],0,-g[0],
g[1],0,g[0],-g[1],0,g[0],g[1],0]);Lemon.SpriteCommand.sharedGeometry.setPositions(g);a.setGeometry(Lemon.SpriteCommand.sharedGeometry);a.drawIndexedPrimitives(Lemon.DrawingMode.TrianglesStrip,0,4)}}};
Lemon.SpriteCommand.isDefaultProgramLoaded=function(){if(Lemon.SpriteCommand.sharedProgram.isReady())return!0;Lemon.SpriteCommand.sharedProgram.loadFromData("uniform mat4 uCamera;uniform mat4 uModel;attribute vec4 aPosition;attribute vec4 aColor;attribute vec2 aTexCoord;varying vec4 vColor;varying vec2 vUV;void main() {gl_Position = (uCamera * uModel) * aPosition;vColor      = aColor;vUV         = aTexCoord;}","uniform lowp sampler2D texture;varying lowp vec4 vColor;varying mediump vec2 vUV;void main() {gl_FragColor = texture2D(texture, vUV) * vColor;}");
return!1};Lemon.Sprite=function(){Lemon.Drawable.call(this);this.blendMode=new Lemon.BlendMode(Lemon.BlendMode.Mode.Alpha);this.color=new Lemon.Color(255,255,255,255);this.rect=[0,0,0,0];this.size=[.5,.5];this.texture=this.customProgram=null};goog.inherits(Lemon.Sprite,Lemon.Drawable);Lemon.Sprite.prototype.setBlendMode=function(a){this.blendMode=a};Lemon.Sprite.prototype.setColor=function(a,b,c,d){this.color.set(a,b,c,d)};Lemon.Sprite.prototype.draw=function(a){this.texture&&a.getActiveTask().addCommand(new Lemon.SpriteCommand(this))};
Lemon.Sprite.prototype.setCustomProgram=function(a){this.customProgram=a};Lemon.Sprite.prototype.setSize=function(a,b){this.size[0]=a;this.size[1]=b};Lemon.Sprite.prototype.setTexture=function(a){this.texture=a};Lemon.Sprite.prototype.setTextureRect=function(a,b,c,d){this.rect=[a,b,c,d]};Lemon.Sprite.prototype.getBlendMode=function(){return this.blendMode};Lemon.Sprite.prototype.getColor=function(){return this.color};Lemon.Sprite.prototype.getCustomProgram=function(){return this.customProgram};
Lemon.Sprite.prototype.getSize=function(){return this.size};Lemon.Sprite.prototype.getTexture=function(){return this.texture};Lemon.Sprite.prototype.getTextureRect=function(){return this.rect};Lemon.RenderTask=function(){this.opaqueQueue=[];this.transparentQueue=[]};Lemon.RenderTask.prototype.addCommand=function(a,b){var c=b||0;a.isOpaque()?(this.opaqueQueue[c]=this.opaqueQueue[c]||[],this.opaqueQueue[c].push(a)):(this.transparentQueue[c]=this.transparentQueue[c]||[],this.transparentQueue[c].push(a))};
Lemon.RenderTask.prototype.execute=function(a){for(var b=0,c=0,b=0;b<this.opaqueQueue.length;b++)for(c=0;c<this.opaqueQueue[b].length;c++)this.opaqueQueue[b][c].execute(a);for(b=0;b<this.transparentQueue.length;b++)for(c=0;c<this.transparentQueue[b].length;c++)this.transparentQueue[b][c].execute(a)};Lemon.RenderTarget=function(){this.activeTask=null;this.context=new Lemon.Private.Context;this.tasks=[];this.renderApi=null};Lemon.RenderTarget.prototype.clear=function(a){};Lemon.RenderTarget.prototype.display=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a].execute(this.renderApi)};Lemon.RenderTarget.prototype.createTask=function(){this.tasks.push(new Lemon.RenderTask);return this.tasks.length-1};
Lemon.RenderTarget.prototype.render=function(a,b){this.renderApi.clearCache();this.renderApi.setActiveCamera(b);this.getActiveTask()||this.setActiveTask(this.createTask());a.visit(this)};Lemon.RenderTarget.prototype.setActiveTask=function(a){0<=a&&a<this.tasks.length&&(this.activeTask=this.tasks[a])};Lemon.RenderTarget.prototype.getActiveTask=function(){return this.activeTask};Lemon.RenderTarget.prototype.removeTasks=function(){this.tasks.length=0;this.activeTask=null};
Lemon.RenderTarget.prototype.getRenderAPI=function(){return this.renderApi};Lemon.RenderTarget.prototype.getSize=function(){return this.context.getSize()};goog.webgl={};goog.webgl.DEPTH_BUFFER_BIT=256;goog.webgl.STENCIL_BUFFER_BIT=1024;goog.webgl.COLOR_BUFFER_BIT=16384;goog.webgl.POINTS=0;goog.webgl.LINES=1;goog.webgl.LINE_LOOP=2;goog.webgl.LINE_STRIP=3;goog.webgl.TRIANGLES=4;goog.webgl.TRIANGLE_STRIP=5;goog.webgl.TRIANGLE_FAN=6;goog.webgl.ZERO=0;goog.webgl.ONE=1;goog.webgl.SRC_COLOR=768;goog.webgl.ONE_MINUS_SRC_COLOR=769;goog.webgl.SRC_ALPHA=770;goog.webgl.ONE_MINUS_SRC_ALPHA=771;goog.webgl.DST_ALPHA=772;goog.webgl.ONE_MINUS_DST_ALPHA=773;
goog.webgl.DST_COLOR=774;goog.webgl.ONE_MINUS_DST_COLOR=775;goog.webgl.SRC_ALPHA_SATURATE=776;goog.webgl.FUNC_ADD=32774;goog.webgl.BLEND_EQUATION=32777;goog.webgl.BLEND_EQUATION_RGB=32777;goog.webgl.BLEND_EQUATION_ALPHA=34877;goog.webgl.FUNC_SUBTRACT=32778;goog.webgl.FUNC_REVERSE_SUBTRACT=32779;goog.webgl.BLEND_DST_RGB=32968;goog.webgl.BLEND_SRC_RGB=32969;goog.webgl.BLEND_DST_ALPHA=32970;goog.webgl.BLEND_SRC_ALPHA=32971;goog.webgl.CONSTANT_COLOR=32769;goog.webgl.ONE_MINUS_CONSTANT_COLOR=32770;
goog.webgl.CONSTANT_ALPHA=32771;goog.webgl.ONE_MINUS_CONSTANT_ALPHA=32772;goog.webgl.BLEND_COLOR=32773;goog.webgl.ARRAY_BUFFER=34962;goog.webgl.ELEMENT_ARRAY_BUFFER=34963;goog.webgl.ARRAY_BUFFER_BINDING=34964;goog.webgl.ELEMENT_ARRAY_BUFFER_BINDING=34965;goog.webgl.STREAM_DRAW=35040;goog.webgl.STATIC_DRAW=35044;goog.webgl.DYNAMIC_DRAW=35048;goog.webgl.BUFFER_SIZE=34660;goog.webgl.BUFFER_USAGE=34661;goog.webgl.CURRENT_VERTEX_ATTRIB=34342;goog.webgl.FRONT=1028;goog.webgl.BACK=1029;
goog.webgl.FRONT_AND_BACK=1032;goog.webgl.CULL_FACE=2884;goog.webgl.BLEND=3042;goog.webgl.DITHER=3024;goog.webgl.STENCIL_TEST=2960;goog.webgl.DEPTH_TEST=2929;goog.webgl.SCISSOR_TEST=3089;goog.webgl.POLYGON_OFFSET_FILL=32823;goog.webgl.SAMPLE_ALPHA_TO_COVERAGE=32926;goog.webgl.SAMPLE_COVERAGE=32928;goog.webgl.NO_ERROR=0;goog.webgl.INVALID_ENUM=1280;goog.webgl.INVALID_VALUE=1281;goog.webgl.INVALID_OPERATION=1282;goog.webgl.OUT_OF_MEMORY=1285;goog.webgl.CW=2304;goog.webgl.CCW=2305;
goog.webgl.LINE_WIDTH=2849;goog.webgl.ALIASED_POINT_SIZE_RANGE=33901;goog.webgl.ALIASED_LINE_WIDTH_RANGE=33902;goog.webgl.CULL_FACE_MODE=2885;goog.webgl.FRONT_FACE=2886;goog.webgl.DEPTH_RANGE=2928;goog.webgl.DEPTH_WRITEMASK=2930;goog.webgl.DEPTH_CLEAR_VALUE=2931;goog.webgl.DEPTH_FUNC=2932;goog.webgl.STENCIL_CLEAR_VALUE=2961;goog.webgl.STENCIL_FUNC=2962;goog.webgl.STENCIL_FAIL=2964;goog.webgl.STENCIL_PASS_DEPTH_FAIL=2965;goog.webgl.STENCIL_PASS_DEPTH_PASS=2966;goog.webgl.STENCIL_REF=2967;
goog.webgl.STENCIL_VALUE_MASK=2963;goog.webgl.STENCIL_WRITEMASK=2968;goog.webgl.STENCIL_BACK_FUNC=34816;goog.webgl.STENCIL_BACK_FAIL=34817;goog.webgl.STENCIL_BACK_PASS_DEPTH_FAIL=34818;goog.webgl.STENCIL_BACK_PASS_DEPTH_PASS=34819;goog.webgl.STENCIL_BACK_REF=36003;goog.webgl.STENCIL_BACK_VALUE_MASK=36004;goog.webgl.STENCIL_BACK_WRITEMASK=36005;goog.webgl.VIEWPORT=2978;goog.webgl.SCISSOR_BOX=3088;goog.webgl.COLOR_CLEAR_VALUE=3106;goog.webgl.COLOR_WRITEMASK=3107;goog.webgl.UNPACK_ALIGNMENT=3317;
goog.webgl.PACK_ALIGNMENT=3333;goog.webgl.MAX_TEXTURE_SIZE=3379;goog.webgl.MAX_VIEWPORT_DIMS=3386;goog.webgl.SUBPIXEL_BITS=3408;goog.webgl.RED_BITS=3410;goog.webgl.GREEN_BITS=3411;goog.webgl.BLUE_BITS=3412;goog.webgl.ALPHA_BITS=3413;goog.webgl.DEPTH_BITS=3414;goog.webgl.STENCIL_BITS=3415;goog.webgl.POLYGON_OFFSET_UNITS=10752;goog.webgl.POLYGON_OFFSET_FACTOR=32824;goog.webgl.TEXTURE_BINDING_2D=32873;goog.webgl.SAMPLE_BUFFERS=32936;goog.webgl.SAMPLES=32937;goog.webgl.SAMPLE_COVERAGE_VALUE=32938;
goog.webgl.SAMPLE_COVERAGE_INVERT=32939;goog.webgl.COMPRESSED_TEXTURE_FORMATS=34467;goog.webgl.DONT_CARE=4352;goog.webgl.FASTEST=4353;goog.webgl.NICEST=4354;goog.webgl.GENERATE_MIPMAP_HINT=33170;goog.webgl.BYTE=5120;goog.webgl.UNSIGNED_BYTE=5121;goog.webgl.SHORT=5122;goog.webgl.UNSIGNED_SHORT=5123;goog.webgl.INT=5124;goog.webgl.UNSIGNED_INT=5125;goog.webgl.FLOAT=5126;goog.webgl.DEPTH_COMPONENT=6402;goog.webgl.ALPHA=6406;goog.webgl.RGB=6407;goog.webgl.RGBA=6408;goog.webgl.LUMINANCE=6409;
goog.webgl.LUMINANCE_ALPHA=6410;goog.webgl.UNSIGNED_SHORT_4_4_4_4=32819;goog.webgl.UNSIGNED_SHORT_5_5_5_1=32820;goog.webgl.UNSIGNED_SHORT_5_6_5=33635;goog.webgl.FRAGMENT_SHADER=35632;goog.webgl.VERTEX_SHADER=35633;goog.webgl.MAX_VERTEX_ATTRIBS=34921;goog.webgl.MAX_VERTEX_UNIFORM_VECTORS=36347;goog.webgl.MAX_VARYING_VECTORS=36348;goog.webgl.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;goog.webgl.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;goog.webgl.MAX_TEXTURE_IMAGE_UNITS=34930;
goog.webgl.MAX_FRAGMENT_UNIFORM_VECTORS=36349;goog.webgl.SHADER_TYPE=35663;goog.webgl.DELETE_STATUS=35712;goog.webgl.LINK_STATUS=35714;goog.webgl.VALIDATE_STATUS=35715;goog.webgl.ATTACHED_SHADERS=35717;goog.webgl.ACTIVE_UNIFORMS=35718;goog.webgl.ACTIVE_ATTRIBUTES=35721;goog.webgl.SHADING_LANGUAGE_VERSION=35724;goog.webgl.CURRENT_PROGRAM=35725;goog.webgl.NEVER=512;goog.webgl.LESS=513;goog.webgl.EQUAL=514;goog.webgl.LEQUAL=515;goog.webgl.GREATER=516;goog.webgl.NOTEQUAL=517;goog.webgl.GEQUAL=518;
goog.webgl.ALWAYS=519;goog.webgl.KEEP=7680;goog.webgl.REPLACE=7681;goog.webgl.INCR=7682;goog.webgl.DECR=7683;goog.webgl.INVERT=5386;goog.webgl.INCR_WRAP=34055;goog.webgl.DECR_WRAP=34056;goog.webgl.VENDOR=7936;goog.webgl.RENDERER=7937;goog.webgl.VERSION=7938;goog.webgl.NEAREST=9728;goog.webgl.LINEAR=9729;goog.webgl.NEAREST_MIPMAP_NEAREST=9984;goog.webgl.LINEAR_MIPMAP_NEAREST=9985;goog.webgl.NEAREST_MIPMAP_LINEAR=9986;goog.webgl.LINEAR_MIPMAP_LINEAR=9987;goog.webgl.TEXTURE_MAG_FILTER=10240;
goog.webgl.TEXTURE_MIN_FILTER=10241;goog.webgl.TEXTURE_WRAP_S=10242;goog.webgl.TEXTURE_WRAP_T=10243;goog.webgl.TEXTURE_2D=3553;goog.webgl.TEXTURE=5890;goog.webgl.TEXTURE_CUBE_MAP=34067;goog.webgl.TEXTURE_BINDING_CUBE_MAP=34068;goog.webgl.TEXTURE_CUBE_MAP_POSITIVE_X=34069;goog.webgl.TEXTURE_CUBE_MAP_NEGATIVE_X=34070;goog.webgl.TEXTURE_CUBE_MAP_POSITIVE_Y=34071;goog.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;goog.webgl.TEXTURE_CUBE_MAP_POSITIVE_Z=34073;goog.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;
goog.webgl.MAX_CUBE_MAP_TEXTURE_SIZE=34076;goog.webgl.TEXTURE0=33984;goog.webgl.TEXTURE1=33985;goog.webgl.TEXTURE2=33986;goog.webgl.TEXTURE3=33987;goog.webgl.TEXTURE4=33988;goog.webgl.TEXTURE5=33989;goog.webgl.TEXTURE6=33990;goog.webgl.TEXTURE7=33991;goog.webgl.TEXTURE8=33992;goog.webgl.TEXTURE9=33993;goog.webgl.TEXTURE10=33994;goog.webgl.TEXTURE11=33995;goog.webgl.TEXTURE12=33996;goog.webgl.TEXTURE13=33997;goog.webgl.TEXTURE14=33998;goog.webgl.TEXTURE15=33999;goog.webgl.TEXTURE16=34E3;
goog.webgl.TEXTURE17=34001;goog.webgl.TEXTURE18=34002;goog.webgl.TEXTURE19=34003;goog.webgl.TEXTURE20=34004;goog.webgl.TEXTURE21=34005;goog.webgl.TEXTURE22=34006;goog.webgl.TEXTURE23=34007;goog.webgl.TEXTURE24=34008;goog.webgl.TEXTURE25=34009;goog.webgl.TEXTURE26=34010;goog.webgl.TEXTURE27=34011;goog.webgl.TEXTURE28=34012;goog.webgl.TEXTURE29=34013;goog.webgl.TEXTURE30=34014;goog.webgl.TEXTURE31=34015;goog.webgl.ACTIVE_TEXTURE=34016;goog.webgl.REPEAT=10497;goog.webgl.CLAMP_TO_EDGE=33071;
goog.webgl.MIRRORED_REPEAT=33648;goog.webgl.FLOAT_VEC2=35664;goog.webgl.FLOAT_VEC3=35665;goog.webgl.FLOAT_VEC4=35666;goog.webgl.INT_VEC2=35667;goog.webgl.INT_VEC3=35668;goog.webgl.INT_VEC4=35669;goog.webgl.BOOL=35670;goog.webgl.BOOL_VEC2=35671;goog.webgl.BOOL_VEC3=35672;goog.webgl.BOOL_VEC4=35673;goog.webgl.FLOAT_MAT2=35674;goog.webgl.FLOAT_MAT3=35675;goog.webgl.FLOAT_MAT4=35676;goog.webgl.SAMPLER_2D=35678;goog.webgl.SAMPLER_CUBE=35680;goog.webgl.VERTEX_ATTRIB_ARRAY_ENABLED=34338;
goog.webgl.VERTEX_ATTRIB_ARRAY_SIZE=34339;goog.webgl.VERTEX_ATTRIB_ARRAY_STRIDE=34340;goog.webgl.VERTEX_ATTRIB_ARRAY_TYPE=34341;goog.webgl.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;goog.webgl.VERTEX_ATTRIB_ARRAY_POINTER=34373;goog.webgl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;goog.webgl.COMPILE_STATUS=35713;goog.webgl.LOW_FLOAT=36336;goog.webgl.MEDIUM_FLOAT=36337;goog.webgl.HIGH_FLOAT=36338;goog.webgl.LOW_INT=36339;goog.webgl.MEDIUM_INT=36340;goog.webgl.HIGH_INT=36341;goog.webgl.FRAMEBUFFER=36160;
goog.webgl.RENDERBUFFER=36161;goog.webgl.RGBA4=32854;goog.webgl.RGB5_A1=32855;goog.webgl.RGB565=36194;goog.webgl.DEPTH_COMPONENT16=33189;goog.webgl.STENCIL_INDEX=6401;goog.webgl.STENCIL_INDEX8=36168;goog.webgl.DEPTH_STENCIL=34041;goog.webgl.RENDERBUFFER_WIDTH=36162;goog.webgl.RENDERBUFFER_HEIGHT=36163;goog.webgl.RENDERBUFFER_INTERNAL_FORMAT=36164;goog.webgl.RENDERBUFFER_RED_SIZE=36176;goog.webgl.RENDERBUFFER_GREEN_SIZE=36177;goog.webgl.RENDERBUFFER_BLUE_SIZE=36178;
goog.webgl.RENDERBUFFER_ALPHA_SIZE=36179;goog.webgl.RENDERBUFFER_DEPTH_SIZE=36180;goog.webgl.RENDERBUFFER_STENCIL_SIZE=36181;goog.webgl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;goog.webgl.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;goog.webgl.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;goog.webgl.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;goog.webgl.COLOR_ATTACHMENT0=36064;goog.webgl.DEPTH_ATTACHMENT=36096;goog.webgl.STENCIL_ATTACHMENT=36128;goog.webgl.DEPTH_STENCIL_ATTACHMENT=33306;
goog.webgl.NONE=0;goog.webgl.FRAMEBUFFER_COMPLETE=36053;goog.webgl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;goog.webgl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;goog.webgl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;goog.webgl.FRAMEBUFFER_UNSUPPORTED=36061;goog.webgl.FRAMEBUFFER_BINDING=36006;goog.webgl.RENDERBUFFER_BINDING=36007;goog.webgl.MAX_RENDERBUFFER_SIZE=34024;goog.webgl.INVALID_FRAMEBUFFER_OPERATION=1286;goog.webgl.UNPACK_FLIP_Y_WEBGL=37440;goog.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;
goog.webgl.CONTEXT_LOST_WEBGL=37442;goog.webgl.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;goog.webgl.BROWSER_DEFAULT_WEBGL=37444;goog.webgl.HALF_FLOAT_OES=36193;goog.webgl.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723;goog.webgl.VERTEX_ARRAY_BINDING_OES=34229;goog.webgl.UNMASKED_VENDOR_WEBGL=37445;goog.webgl.UNMASKED_RENDERER_WEBGL=37446;goog.webgl.COMPRESSED_RGB_S3TC_DXT1_EXT=33776;goog.webgl.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777;goog.webgl.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778;
goog.webgl.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779;goog.webgl.TEXTURE_MAX_ANISOTROPY_EXT=34046;goog.webgl.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047;Lemon.RenderAPI.WebGL=function(){Lemon.RenderAPI.call(this);this.cache=new Lemon.WebGL.Cache;this.enabledVertexAttribArray=[];this.instances=new Lemon.WebGLObjects.Instances;this.state=new Lemon.StateBlock;this.initStateBlockWithDefaultValues(this.state)};goog.inherits(Lemon.RenderAPI.WebGL,Lemon.RenderAPI);goog.addSingletonGetter(Lemon.RenderAPI.WebGL);Lemon.RenderAPI.WebGL.prototype.bindLight=function(a){this.cache.lights.push(a)};
Lemon.RenderAPI.WebGL.prototype.bindFrameBuffer=function(a){var b=Lemon.GetContext();-1==a?b.bindFramebuffer(goog.webgl.FRAMEBUFFER,null):(a=this.instances.frameBuffers[a])&&b.bindFramebuffer(goog.webgl.FRAMEBUFFER,a)};
Lemon.RenderAPI.WebGL.prototype.bindTexture=function(a,b){if(b.isReady()){var c=b instanceof Lemon.TextureVideo,d=!1,e=Lemon.GetContext(),f=this.instances.textures[b.getUID()];f||(f=e.createTexture(),this.instances.textures[b.getUID()]=f,d=!0);this.cache.texture!=b&&(e.activeTexture(goog.webgl.TEXTURE0+a),e.bindTexture(goog.webgl.TEXTURE_2D,f));d?(f=[0,0],e.pixelStorei(goog.webgl.UNPACK_FLIP_Y_WEBGL,!0),c?e.texImage2D(goog.webgl.TEXTURE_2D,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,
b.getVideoData()):(f=b.getImage(),d=f.getData(),f=f.getSize(),d instanceof Image?e.texImage2D(goog.webgl.TEXTURE_2D,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d):e.texImage2D(goog.webgl.TEXTURE_2D,0,goog.webgl.RGBA,f[0],f[1],0,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d)),d=0===(f[0]&f[0]-1)&&0===(f[1]&f[1]-1),e.texParameteri(goog.webgl.TEXTURE_2D,goog.webgl.TEXTURE_WRAP_S,b.isRepeated()?goog.webgl.REPEAT:goog.webgl.CLAMP_TO_EDGE),e.texParameteri(goog.webgl.TEXTURE_2D,goog.webgl.TEXTURE_WRAP_T,
b.isRepeated()?goog.webgl.REPEAT:goog.webgl.CLAMP_TO_EDGE),e.texParameteri(goog.webgl.TEXTURE_2D,goog.webgl.TEXTURE_MAG_FILTER,b.isSmoothed()?goog.webgl.LINEAR:goog.webgl.NEAREST),f=d&&b.isMipmaped()?goog.webgl.LINEAR_MIPMAP_NEAREST:goog.webgl.LINEAR,e.texParameteri(goog.webgl.TEXTURE_2D,goog.webgl.TEXTURE_MIN_FILTER,b.isSmoothed()?f:goog.webgl.NEAREST),!c&&d&&b.isMipmaped()&&e.generateMipmap(goog.webgl.TEXTURE_2D)):c&&e.texImage2D(goog.webgl.TEXTURE_2D,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,
b.getVideoData());this.cache.texture=b}};
Lemon.RenderAPI.WebGL.prototype.bindTextureCube=function(a,b){if(b.isReady()){var c=Lemon.GetContext(),d=!1,e=this.instances.textures[b.getUID()];e||(e=c.createTexture(),this.instances.textures[b.getUID()]=e,d=!0);this.cache.texture!=b&&(c.activeTexture(goog.webgl.TEXTURE0+a),c.bindTexture(goog.webgl.TEXTURE_CUBE_MAP,e));d&&(d=b.getImages(),c.texImage2D(goog.webgl.TEXTURE_CUBE_MAP_POSITIVE_X,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d[Lemon.TextureCube.Face.Left].getData()),c.texImage2D(goog.webgl.TEXTURE_CUBE_MAP_NEGATIVE_X,
0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d[Lemon.TextureCube.Face.Right].getData()),c.texImage2D(goog.webgl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d[Lemon.TextureCube.Face.Up].getData()),c.texImage2D(goog.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d[Lemon.TextureCube.Face.Down].getData()),c.texImage2D(goog.webgl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,
d[Lemon.TextureCube.Face.Front].getData()),c.texImage2D(goog.webgl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,goog.webgl.RGBA,goog.webgl.RGBA,goog.webgl.UNSIGNED_BYTE,d[Lemon.TextureCube.Face.Back].getData()),c.texParameteri(goog.webgl.TEXTURE_CUBE_MAP,goog.webgl.TEXTURE_MAG_FILTER,goog.webgl.NEAREST),c.texParameteri(goog.webgl.TEXTURE_CUBE_MAP,goog.webgl.TEXTURE_MIN_FILTER,goog.webgl.NEAREST));this.cache.texture=b}};
Lemon.RenderAPI.WebGL.prototype.clear=function(a){a.isEqual(this.cache.clearColor)||(Lemon.GetContext().clearColor(a.r,a.g,a.b,a.a),this.cache.clearColor=a);Lemon.GetContext().clear(goog.webgl.COLOR_BUFFER_BIT|goog.webgl.DEPTH_BUFFER_BIT|goog.webgl.DEPTH_BUFFER_BIT)};Lemon.RenderAPI.WebGL.prototype.clearCache=function(){this.cache.program=null;this.cache.lights.length=0};
Lemon.RenderAPI.WebGL.prototype.createFrameBuffer=function(){var a=this.instances.frameBuffers.length,b=Lemon.GetContext().createFramebuffer();this.instances.frameBuffers.push(b);return a};Lemon.RenderAPI.WebGL.prototype.drawIndexedPrimitives=function(a,b,c){Lemon.GetContext().drawElements(this.convertDrawingModeToConstant(a),c,goog.webgl.UNSIGNED_SHORT,b);this.disableVertexAttribArray()};
Lemon.RenderAPI.WebGL.prototype.drawPrimitives=function(a,b,c){Lemon.GetContext().drawArrays(this.convertDrawingModeToConstant(a),b,c);this.disableVertexAttribArray()};Lemon.RenderAPI.WebGL.prototype.disableVertexAttribArray=function(){var a=Lemon.GetContext(),b;for(b in this.enabledVertexAttribArray)a.disableVertexAttribArray(b)};
Lemon.RenderAPI.WebGL.prototype.initFrameBuffer=function(a,b,c,d){if(this.instances.frameBuffers[a]){var e=Lemon.GetContext(),f=[0,0];this.bindFrameBuffer(a);for(a=0;a<b.length;a++){this.bindTexture(a,b[a]);var f=b[a].getImage().getSize(),g=this.instances.textures[b[a].getUID()];e.framebufferTexture2D(goog.webgl.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a,goog.webgl.TEXTURE_2D,g,0)}if(c||d)b=e.createRenderbuffer(),e.bindRenderbuffer(goog.webgl.RENDERBUFFER,b),d?(e.renderbufferStorage(goog.webgl.RENDERBUFFER,
goog.webgl.DEPTH_STENCIL,f[0],f[1]),e.framebufferRenderbuffer(goog.webgl.FRAMEBUFFER,goog.webgl.DEPTH_STENCIL_ATTACHMENT,goog.webgl.RENDERBUFFER,b)):(e.renderbufferStorage(goog.webgl.RENDERBUFFER,goog.webgl.DEPTH_COMPONENT16,f[0],f[1]),e.framebufferRenderbuffer(goog.webgl.FRAMEBUFFER,goog.webgl.DEPTH_ATTACHMENT,goog.webgl.RENDERBUFFER,b)),e.bindRenderbuffer(goog.webgl.RENDERBUFFER,null);this.bindFrameBuffer(-1)}};
Lemon.RenderAPI.WebGL.prototype.initStateBlockWithDefaultValues=function(a){this.state.depthTest=!1;this.state.depthWrite=!1;this.state.stencilTest=!1};
Lemon.RenderAPI.WebGL.prototype.sendLights=function(a){if(this.instances.programs[a.getUID()]){for(var b=this.cache.lights.length,c=this.cache.lights[0],d=!1,e=!1,f=0,g=0;f<this.cache.lights.length;f++,g+=3){c=this.cache.lights[f];this.cache.lightsType[f]=c instanceof Lemon.PointLight?0:c instanceof Lemon.DirectionalLight?1:2;var h=c.getAmbientColor();this.cache.lightsAmbient[g]=h.r;this.cache.lightsAmbient[g+1]=h.g;this.cache.lightsAmbient[g+2]=h.b;1!=this.cache.lightsType[f]?(d=c.getValues(),this.cache.lightsData[g]=
d[0],this.cache.lightsData[g+1]=d[1],this.cache.lightsData[g+2]=d[2],d=!0):(this.cache.lightsData[g]=0,this.cache.lightsData[g+1]=0,this.cache.lightsData[g+2]=0);h=c.getDiffuseColor();this.cache.lightsDiffuse[g]=h.r;this.cache.lightsDiffuse[g+1]=h.g;this.cache.lightsDiffuse[g+2]=h.b;0!==this.cache.lightsType[f]?(e=c.getDirection(),this.cache.lightsDirection[g]=e[0],this.cache.lightsDirection[g+1]=e[1],this.cache.lightsDirection[g+2]=e[2],e=!0):(this.cache.lightsDirection[g]=0,this.cache.lightsDirection[g+
1]=0,this.cache.lightsDirection[g+2]=0);h=c.getPosition();this.cache.lightsPosition[g]=h[0];this.cache.lightsPosition[g+1]=h[1];this.cache.lightsPosition[g+2]=h[2];c=c.getSpecularColor();this.cache.lightsSpecular[g]=c.r;this.cache.lightsSpecular[g+1]=c.g;this.cache.lightsSpecular[g+2]=c.b}this.cache.lights.length&&(this.setUniform(a,"uCameraPosition",Lemon.Type.Float,this.activeCamera.getPosition()),this.setUniform(a,"lights.count",Lemon.Type.Int,b),this.setUniform(a,"lights.ambient",Lemon.Type.Float,
this.cache.lightsAmbient,3),d&&this.setUniform(a,"lights.data",Lemon.Type.Float,this.cache.lightsData,3),this.setUniform(a,"lights.diffuse",Lemon.Type.Float,this.cache.lightsDiffuse,3),e&&this.setUniform(a,"lights.direction",Lemon.Type.Float,this.cache.lightsDirection,3),this.setUniform(a,"lights.position",Lemon.Type.Float,this.cache.lightsPosition,3),this.setUniform(a,"lights.specular",Lemon.Type.Float,this.cache.lightsSpecular,3),this.setUniform(a,"lights.type",Lemon.Type.Int,this.cache.lightsType,
1))}};Lemon.RenderAPI.WebGL.prototype.setActiveCamera=function(a){Lemon.RenderAPI.prototype.setActiveCamera.call(this,a);a=a.getViewport();Lemon.GetContext().viewport(a[0],a[1],a[2],a[3])};
Lemon.RenderAPI.WebGL.prototype.setBlendMode=function(a){if(!a.isEqual(this.state.blendMode)){var b=Lemon.GetContext();a.colorSourceFactor==Lemon.BlendMode.Factor.One&&a.colorDestinationFactor==Lemon.BlendMode.Factor.Zero?b.disable(goog.webgl.BLEND):(b.enable(goog.webgl.BLEND),b.blendEquationSeparate(this.convertBlendingEquationToConstant(a.colorEquation),this.convertBlendingEquationToConstant(a.alphaEquation)),b.blendFuncSeparate(this.convertBlendingFactorToConstant(a.colorSourceFactor),this.convertBlendingFactorToConstant(a.colorDestinationFactor),
this.convertBlendingFactorToConstant(a.alphaSourceFactor),this.convertBlendingFactorToConstant(a.alphaDestinationFactor)));this.state.blendMode=a}};
Lemon.RenderAPI.WebGL.prototype.setDepthState=function(a,b,c){var d=Lemon.GetContext();!a&&this.state.depthTest?d.disable(goog.webgl.DEPTH_TEST):a&&(this.state.depthTest||d.enable(goog.webgl.DEPTH_TEST),this.state.writeTest!=b&&(d.depthMask(b),this.state.writeTest=b),this.state.depthFunction!=c&&(d.depthFunc(this.convertDepthFunctionToConstant(c)),this.state.depthFunction=c));this.state.depthTest=a};
Lemon.RenderAPI.WebGL.prototype.setFaceCulling=function(a){if(this.state.faceCulling!=a){var b=Lemon.GetContext();a==Lemon.FaceCulling.None?b.disable(goog.webgl.CULL_FACE):(this.state.faceCulling==Lemon.FaceCulling.None&&b.enable(goog.webgl.CULL_FACE),a==Lemon.FaceCulling.Front?b.cullFace(goog.webgl.FRONT):b.cullFace(goog.webgl.BACK));this.state.faceCulling=a}};Lemon.RenderAPI.WebGL.prototype.setIndexBuffer=function(a){Lemon.GetContext().bindBuffer(goog.webgl.ELEMENT_ARRAY_BUFFER,a)};
Lemon.RenderAPI.WebGL.prototype.setGeometry=function(a){if(a.getVertexFormat()){this.setVertexFormat(a.getVertexFormat());var b=Lemon.GetContext(),c=this.instances.buffers[a.getUID()];c||(c=new Lemon.WebGLObjects.BufferData,this.instances.buffers[a.getUID()]=c);c.indexBuffer||(c.indexBuffer=b.createBuffer());this.setIndexBuffer(c.indexBuffer);this.cache.vertexFormat.isIndicesWaitingUpdate()&&(b.bufferData(goog.webgl.ELEMENT_ARRAY_BUFFER,a.getIndices(),goog.webgl.STATIC_DRAW),this.cache.vertexFormat.setIndicesAsWaitingUpdate(!1));
for(var d=this.cache.vertexFormat.getElements(),e=0;e<d.length;e++)if(c.vertexBuffers[e]||(c.vertexBuffers[e]=b.createBuffer()),this.setVertexBuffer(e,c.vertexBuffers[e]),this.cache.vertexFormat.isStreamWaitingUpdate(d[e].stream)){var f=this.convertStreamTypeToConstant(this.cache.vertexFormat.getStreamType(d[e].stream));switch(d[e].usage){case Lemon.VertexElement.Usage.Position:b.bufferData(goog.webgl.ARRAY_BUFFER,a.getVerticesPositions(),f);break;case Lemon.VertexElement.Usage.Color:b.bufferData(goog.webgl.ARRAY_BUFFER,
a.getVerticesColors(),f);break;case Lemon.VertexElement.Usage.UVS:b.bufferData(goog.webgl.ARRAY_BUFFER,a.getVerticesUVs(),f);break;case Lemon.VertexElement.Usage.Normal:b.bufferData(goog.webgl.ARRAY_BUFFER,a.getVerticesNormals(),f);break;default:case Lemon.VertexElement.Usage.Tangent:console.log("Given vertex element is not supported for now.")}this.cache.vertexFormat.setStreamAsWaitingUpdate(d[e].usage,!1)}}};
Lemon.RenderAPI.WebGL.prototype.setProgram=function(a){var b=this.instances.programs[a.getUID()],c=Lemon.GetContext();if(!b){if(!a.isReady())return-1;var b=a.getSources(),d=c.createProgram(),e=c.createShader(goog.webgl.VERTEX_SHADER);c.shaderSource(e,b[0]);c.compileShader(e);var f=c.createShader(goog.webgl.FRAGMENT_SHADER);c.shaderSource(f,b[1]);c.compileShader(f);c.attachShader(d,e);c.attachShader(d,f);c.bindAttribLocation(d,Lemon.VertexElement.Usage.Position,"aPosition");c.bindAttribLocation(d,
Lemon.VertexElement.Usage.UVS,"aTexCoord");c.bindAttribLocation(d,Lemon.VertexElement.Usage.Color,"aColor");c.bindAttribLocation(d,Lemon.VertexElement.Usage.Normal,"aNormal");c.bindAttribLocation(d,Lemon.VertexElement.Usage.Tangent,"aTangent");c.linkProgram(d);c.deleteShader(e);c.deleteShader(f);for(var b=this.instances.programs[a.getUID()]=d,f=c.getProgramParameter(d,goog.webgl.ACTIVE_UNIFORMS),g=a.getUniforms(),e=0;e<f;e++){var h=c.getActiveUniform(d,e),l=h.name,k=h.name.indexOf("[",h.name.length-
3);0<=k&&(l=h.name.substring(0,k));g[l]=new Lemon.Program.Element(c.getUniformLocation(d,h.name),l,this.convertConstantToShaderTypes(h.type),h.size)}f=c.getProgramParameter(d,goog.webgl.ACTIVE_ATTRIBUTES);g=a.getAttributes();for(e=0;e<f;e++)h=c.getActiveAttrib(d,e),g[h.name]=new Lemon.Program.Element(c.getAttribLocation(d,h.name),h.name,this.convertConstantToShaderTypes(h.type),h.size)}return this.cache.program!=b?(c.useProgram(b),this.cache.program=b,this.sendLights(a),1):0};
Lemon.RenderAPI.WebGL.prototype.setUniform=function(a,b,c,d,e){e=e||0;this.setProgram(a);a=a.getUniform(b);if(!a||!d)return!1;b=Lemon.GetContext();switch(c){case Lemon.Type.Float:d instanceof Array?e&&1<=e?2==e?b.uniform2fv(a.location,d):3==e?b.uniform3fv(a.location,d):4==e?b.uniform4fv(a.location,d):1==e&&b.uniform1fv(a.location,d):3==d.length?b.uniform3f(a.location,d[0],d[1],d[2]):4==d.length?b.uniform4f(a.location,d[0],d[1],d[2],d[3]):3==d.length&&b.uniform2f(a.location,d[0],d[1]):b.uniform1f(a.location,
d);break;case Lemon.Type.Int:d instanceof Array?e&&1<=e?2==e?b.uniform2iv(a.location,d):3==e?b.uniform3iv(a.location,d):4==e?b.uniform4iv(a.location,d):1==e&&b.uniform1iv(a.location,d):3==d.length?b.uniform3i(a.location,d[0],d[1],d[2]):4==d.length?b.uniform4i(a.location,d[0],d[1],d[2],d[3]):2==d.length&&b.uniform2i(a.location,d[0],d[1]):b.uniform1i(a.location,d);break;case Lemon.Type.Matrix:16==d.length?b.uniformMatrix4fv(a.location,!1,d):4==d.length?b.uniformMatrix2fv(a.location,!1,d):9==d.length&&
b.uniformMatrix3fv(a.location,!1,d)}return!0};Lemon.RenderAPI.WebGL.prototype.setScissorTest=function(a,b,c,d,e){var f=Lemon.GetContext();a?(f.enable(goog.webgl.SCISSOR_TEST),f.scissor(b,c,d,e)):f.disable(goog.webgl.SCISSOR_TEST)};
Lemon.RenderAPI.WebGL.prototype.setStencilState=function(a,b){var c=Lemon.GetContext();!a&&this.state.stencilTest?c.disable(goog.webgl.STENCIL_TEST):a&&(this.state.stencilTest||c.enable(goog.webgl.STENCIL_TEST),this.state.stencilWrite!=b&&(c.stencilMask(b),this.state.stencilWrite=b));this.state.stencilTest=a};
Lemon.RenderAPI.WebGL.prototype.setStencilFunction=function(a,b,c){if(this.state.stencilFunction!=a||this.state.stencilReference!=b||this.state.stencilMask!=c)Lemon.GetContext().stencilFunc(this.convertStencilFunctionToConstant(a),b,c),this.state.stencilFunction=a,this.state.stencilReference=b,this.state.stencilMask=c};
Lemon.RenderAPI.WebGL.prototype.setStencilOperations=function(a,b,c){if(this.state.stencilTestFail!=a||this.state.stencilDepthTestFail!=b||this.state.stencilSuccess!=c)Lemon.GetContext().stencilOp(this.convertStencilOperationToConstant(a),this.convertStencilOperationToConstant(b),this.convertStencilOperationToConstant(c)),this.state.stencilTestFail=a,this.state.stencilDepthTestFail=b,this.state.stencilSuccess=c};
Lemon.RenderAPI.WebGL.prototype.setVertexBuffer=function(a,b){var c=Lemon.GetContext();c.bindBuffer(goog.webgl.ARRAY_BUFFER,b);for(var d=this.cache.vertexFormat.getElements(),e=0;e<d.length;e++)d[e].stream==a&&(c.enableVertexAttribArray(d[e].usage),c.vertexAttribPointer(d[e].usage,d[e].count,this.convertVertexTypeToConstant(d[e].type),d[e].normalize,this.cache.vertexFormat.getStreamStride(d[e].stream),d[e].offset),this.enabledVertexAttribArray[d[e].usage]=!0)};
Lemon.RenderAPI.WebGL.prototype.setVertexFormat=function(a){this.cache.vertexFormat=a};
Lemon.RenderAPI.WebGL.prototype.convertBlendingFactorToConstant=function(a){switch(a){default:case Lemon.BlendMode.Factor.Zero:return goog.webgl.ZERO;case Lemon.BlendMode.Factor.One:return goog.webgl.ONE;case Lemon.BlendMode.Factor.SourceColor:return goog.webgl.SRC_COLOR;case Lemon.BlendMode.Factor.OneMinusSourceColor:return goog.webgl.ONE_MINUS_SRC_COLOR;case Lemon.BlendMode.Factor.DestinationColor:return goog.webgl.DST_COLOR;case Lemon.BlendMode.Factor.OneMinusDestinationColor:return goog.webgl.ONE_MINUS_DST_COLOR;
case Lemon.BlendMode.Factor.SourceAlpha:return goog.webgl.SRC_ALPHA;case Lemon.BlendMode.Factor.OneMinusSourceAlpha:return goog.webgl.ONE_MINUS_SRC_ALPHA;case Lemon.BlendMode.Factor.DestinationAlpha:return goog.webgl.DST_ALPHA;case Lemon.BlendMode.Factor.OneMinusDestinationAlpha:return goog.webgl.ONE_MINUS_DST_ALPHA}};Lemon.RenderAPI.WebGL.prototype.convertBlendingEquationToConstant=function(a){switch(a){default:case Lemon.BlendMode.Equation.Add:return goog.webgl.FUNC_ADD;case Lemon.BlendMode.Equation.Subtract:return goog.webgl.FUNC_SUBTRACT}};
Lemon.RenderAPI.WebGL.prototype.convertDepthFunctionToConstant=function(a){switch(a){case Lemon.DepthFunction.Never:return goog.webgl.NEVER;case Lemon.DepthFunction.Less:return goog.webgl.LESS;case Lemon.DepthFunction.Equal:return goog.webgl.EQUAL;case Lemon.DepthFunction.LessEqual:return goog.webgl.LEQUAL;case Lemon.DepthFunction.Greater:return goog.webgl.GREATER;case Lemon.DepthFunction.NotEqual:return goog.webgl.NOTEQUAL;case Lemon.DepthFunction.GreaterEqual:return goog.webgl.GEQUAL;case Lemon.DepthFunction.Always:return goog.webgl.ALWAYS;
default:return goog.webgl.LEQUAL}};Lemon.RenderAPI.WebGL.prototype.convertDrawingModeToConstant=function(a){switch(a){default:case Lemon.DrawingMode.Points:return goog.webgl.POINTS;case Lemon.DrawingMode.Lines:return goog.webgl.LINES;case Lemon.DrawingMode.LinesStrip:return goog.webgl.LINE_STRIP;case Lemon.DrawingMode.LinesLoop:return goog.webgl.LINE_LOOP;case Lemon.DrawingMode.Triangles:return goog.webgl.TRIANGLES;case Lemon.DrawingMode.TrianglesStrip:return goog.webgl.TRIANGLE_STRIP;case Lemon.DrawingMode.TrianglesFan:return goog.webgl.TRIANGLE_FAN}};
Lemon.RenderAPI.WebGL.prototype.convertStencilFunctionToConstant=function(a){switch(a){case Lemon.StencilFunction.Never:return goog.webgl.NEVER;case Lemon.StencilFunction.Less:return goog.webgl.LESS;case Lemon.StencilFunction.Equal:return goog.webgl.EQUAL;case Lemon.StencilFunction.LessEqual:return goog.webgl.LEQUAL;case Lemon.StencilFunction.Greater:return goog.webgl.GREATER;case Lemon.StencilFunction.NotEqual:return goog.webgl.NOTEQUAL;case Lemon.StencilFunction.GreaterEqual:return goog.webgl.GEQUAL;
case Lemon.StencilFunction.Always:return goog.webgl.ALWAYS;default:return goog.webgl.LEQUAL}};
Lemon.RenderAPI.WebGL.prototype.convertStencilOperationToConstant=function(a){switch(a){default:case Lemon.StencilOperation.Keep:return goog.webgl.KEEP;case Lemon.StencilOperation.Zero:return goog.webgl.ZERO;case Lemon.StencilOperation.Replace:return goog.webgl.REPLACE;case Lemon.StencilOperation.Increment:return goog.webgl.INCR;case Lemon.StencilOperation.Decrement:return goog.webgl.DECR;case Lemon.StencilOperation.Invert:return goog.webgl.INVERT;case Lemon.StencilOperation.IncrementWrap:return goog.webgl.INCR_WRAP;
case Lemon.StencilOperation.DecrementWrap:return goog.webgl.DECR_WRAP}};Lemon.RenderAPI.WebGL.prototype.convertVertexTypeToConstant=function(a){switch(a){default:case Lemon.VertexElement.Type.Byte:return goog.webgl.BYTE;case Lemon.VertexElement.Type.Float:return goog.webgl.FLOAT;case Lemon.VertexElement.Type.Int:return goog.webgl.INT;case Lemon.VertexElement.Type.Short:return goog.webgl.SHORT}};
Lemon.RenderAPI.WebGL.prototype.convertStreamTypeToConstant=function(a){switch(a){default:case Lemon.VertexElement.StreamType.Static:return goog.webgl.STATIC_DRAW;case Lemon.VertexElement.StreamType.Dynamic:return goog.webgl.DYNAMIC_DRAW;case Lemon.VertexElement.StreamType.Stream:return goog.webgl.STREAM_DRAW}};
Lemon.RenderAPI.WebGL.prototype.convertConstantToShaderTypes=function(a){switch(a){default:case goog.webgl.FLOAT:case goog.webgl.FLOAT_VEC2:case goog.webgl.FLOAT_VEC3:case goog.webgl.FLOAT_VEC4:return Lemon.Type.Float;case goog.webgl.INT:case goog.webgl.INT_VEC2:case goog.webgl.INT_VEC3:case goog.webgl.INT_VEC4:return Lemon.Type.Int;case goog.webgl.BOOL:case goog.webgl.BOOL_VEC2:case goog.webgl.BOOL_VEC3:case goog.webgl.BOOL_VEC4:return Lemon.Type.Bool;case goog.webgl.FLOAT_MAT2:case goog.webgl.FLOAT_MAT3:case goog.webgl.FLOAT_MAT4:return Lemon.Type.Matrix;
case goog.webgl.SAMPLER_2D:return Lemon.Type.Texture2D;case goog.webgl.SAMPLER_CUBE:return Lemon.Type.TextureCube;case goog.webgl.BYTE:return Lemon.Type.Byte;case goog.webgl.UNSIGNED_BYTE:return Lemon.Type.u_Byte;case goog.webgl.SHORT:return Lemon.Type.Short;case goog.webgl.UNSIGNED_SHORT:return Lemon.Type.u_Short;case goog.webgl.UNSIGNED_INT:return Lemon.Type.u_Int}};
Lemon.RenderAPI.WebGL.prototype.convertConstantToShaderCount=function(a){switch(a){default:case goog.webgl.FLOAT:case goog.webgl.INT:case goog.webgl.BOOL:case goog.webgl.SAMPLER_2D:case goog.webgl.SAMPLER_CUBE:case goog.webgl.BYTE:case goog.webgl.UNSIGNED_BYTE:case goog.webgl.SHORT:case goog.webgl.UNSIGNED_SHORT:case goog.webgl.UNSIGNED_INT:return 1;case goog.webgl.FLOAT_VEC2:case goog.webgl.INT_VEC2:case goog.webgl.BOOL_VEC2:case goog.webgl.FLOAT_MAT2:return 2;case goog.webgl.FLOAT_VEC3:case goog.webgl.INT_VEC3:case goog.webgl.BOOL_VEC3:case goog.webgl.FLOAT_MAT3:return 3;
case goog.webgl.FLOAT_VEC4:case goog.webgl.INT_VEC4:case goog.webgl.BOOL_VEC4:case goog.webgl.FLOAT_MAT4:return 4}};Lemon.RenderCanvas=function(a,b,c){Lemon.RenderTarget.call(this);this.renderApi=Lemon.RenderAPI.WebGL.getInstance();this.context.init(Lemon.Private.Context.Type.WebGL,b||{},a)};goog.inherits(Lemon.RenderCanvas,Lemon.RenderTarget);Lemon.RenderCanvas.prototype.clear=function(a){this.removeTasks();this.context.activate();this.renderApi.clear(a)};Lemon.RenderTexture=function(a,b,c,d,e){Lemon.RenderTarget.call(this);this.renderApi=Lemon.RenderAPI.WebGL.getInstance();this.framebuffer=this.renderApi.createFrameBuffer();this.textures=[];this.init(a,b,c,d,e)};goog.inherits(Lemon.RenderTexture,Lemon.RenderTarget);
Lemon.RenderTexture.prototype.init=function(a,b,c,d,e){for(var f=0;f<c;f++){var g=new Lemon.Image;g.create(a,b,null);var h=new Lemon.Texture;h.setRepeated(!1);h.setSmooth(!0);h.useMipmap(!1);h.loadFromImage(g);this.textures.push(h)}this.renderApi.initFrameBuffer(this.framebuffer,this.textures,d,e)};Lemon.RenderTexture.prototype.clear=function(a){this.removeTasks();this.begin();this.renderApi.clear(a)};Lemon.RenderTexture.prototype.begin=function(){this.renderApi.bindFrameBuffer(this.framebuffer)};
Lemon.RenderTexture.prototype.display=function(){Lemon.RenderTarget.prototype.display.call(this);this.renderApi.bindFrameBuffer(-1)};Lemon.RenderTexture.prototype.getTextures=function(){return this.textures};Lemon.PostEffect=function(a){this.renderApi=Lemon.RenderAPI.WebGL.getInstance();this.renderTexture=null;this.sprite=new Lemon.Sprite;this.sprite.setCustomProgram(a)};Lemon.PostEffect.prototype.init=function(a,b,c,d){this.renderTexture=new Lemon.RenderTexture(a,b,1,c||!0,d||!1);this.sprite.setSize(1,1);this.sprite.setTexture(this.renderTexture.getTextures()[0]);this.sprite.setTextureRect(0,0,a,b)};
Lemon.PostEffect.prototype.begin=function(a){this.renderTexture&&this.renderTexture.clear(a||new Lemon.Color(30,30,30))};Lemon.PostEffect.prototype.end=function(){this.renderTexture&&(this.renderTexture.display(),Lemon.SpriteCommand.draw(this.renderApi,this.sprite))};Lemon.PostEffect.prototype.render=function(a,b){this.renderTexture.render(a,b)};Lemon.PostEffect.prototype.setProgram=function(a){this.sprite.setCustomProgram(a)};
Lemon.PostEffect.prototype.setEffectValue=function(a,b,c,d){this.renderApi.setUniform(this.sprite.getCustomProgram(),a,b,c,d)};
